<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>unalomecodesæ³°åœ‹å¯ºå»ŸåŠç¾é£Ÿåœ°åœ–</title>
  <meta name="description" content="ğŸ‡¹ğŸ‡­ æ³°åœ‹æ—…éŠå³æ™‚å°å·¥å…·ä¸­å¿ƒï¼šå®šä½ä½ åœ¨å“ªä¸€å€ã€å¤©æ°£å»ºè­°ã€äº¤é€šæ–¹å¼ã€é™„è¿‘æ¨è–¦ 3â€“5 å€‹æ™¯é»èˆ‡ç¾é£Ÿã€‚è®“ä½ æ¯å¤©éƒ½èƒ½å¿«é€Ÿæ‰¾åˆ°ç­”æ¡ˆã€‚">
  <meta name="robots" content="noindex, nofollow">
  <meta property="og:title" content="unalomecodesæ³°åœ‹å¯ºå»ŸåŠç¾é£Ÿåœ°åœ–">
  <meta property="og:description" content="æ³°åœ‹æ—…éŠå³æ™‚å°å·¥å…·ä¸­å¿ƒï¼šå®šä½ã€å¤©æ°£ã€äº¤é€šèˆ‡é™„è¿‘æ¨è–¦ï¼Œçµ¦å°ç£æ—…å®¢çš„æ¯æ—¥å…¥å£ã€‚">
  <meta property="og:image" content="https://shop.unalomecodes.com/img/logo.png">
  <meta property="og:url" content="https://shop.unalomecodes.com/live-tools-preview-84k2">
  <meta property="og:type" content="website">
  <link rel="icon" href="/img/favicon.png" type="image/png">
  <link rel="apple-touch-icon" href="/img/favicon.png">
  <link rel="canonical" href="https://shop.unalomecodes.com/live-tools-preview-84k2">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f5f1ea;
      --ink:#101729;
      --muted:#64748b;
      --brand:#0f766e;
      --accent:#f97316;
      --soft:#fff7ed;
      --card:#ffffff;
      --line:#e2e8f0;
      --shadow:0 22px 48px rgba(15,23,42,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Noto Sans TC", "PingFang TC", sans-serif;
      color:var(--ink);
      background:radial-gradient(1200px 600px at 85% -20%, #c3f0e6 0%, rgba(195,240,230,0) 70%), linear-gradient(180deg,#f7f3ed, #f3efe7);
    }
    .wrap{max-width:1180px;margin:0 auto;padding:28px 20px 80px;}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap;}
    .brand{display:flex;align-items:center;gap:12px;}
    .brand img{width:46px;height:46px;border-radius:14px;border:1px solid #d6c8b6;background:#fff;object-fit:cover;}
    .brand h1{margin:0;font-family:"Fraunces", serif;font-size:24px;letter-spacing:.02em;}
    .brand p{margin:0;color:var(--muted);font-size:12px;}
    .nav{display:flex;gap:10px;flex-wrap:wrap;}
    .pill{
      padding:8px 14px;border-radius:999px;border:1px solid #ffe1cf;background:#fff;
      color:#c2410c;font-weight:700;text-decoration:none;box-shadow:0 10px 20px rgba(249,115,22,.12);
    }
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;margin-top:24px;}
    .hero-card{
      background:var(--card);border-radius:24px;padding:22px;border:1px solid var(--line);
      box-shadow:var(--shadow);display:grid;gap:12px;
    }
    .hero-title{font-family:"Fraunces", serif;font-size:30px;margin:0;}
    .hero-sub{margin:0;color:#475569;line-height:1.7;}
    .cta-row{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px;}
    .btn{
      padding:10px 16px;border-radius:14px;border:1px solid transparent;cursor:pointer;
      font-weight:700;text-decoration:none;display:inline-flex;align-items:center;gap:8px;
    }
    .btn.primary{background:linear-gradient(135deg,#ff7a18,#f59e0b);color:#fff;box-shadow:0 12px 24px rgba(249,115,22,.25);}
    .btn.ghost{background:#fff;border-color:#ffd7c7;color:#c2410c;}
    .panel{background:var(--card);border-radius:20px;border:1px solid var(--line);padding:18px;display:grid;gap:14px;}
    .section-title{font-weight:800;font-size:16px;margin:0;}
    .grid{display:grid;gap:16px;margin-top:20px;}
    .grid-2{grid-template-columns:repeat(2,minmax(0,1fr));}
    .grid-3{grid-template-columns:repeat(3,minmax(0,1fr));}
    .mini{font-size:12px;color:var(--muted);}
    .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap;}
    .input, select{
      border:1px solid var(--line);border-radius:12px;padding:8px 10px;font-size:14px;
      background:#fff;font-family:inherit;color:var(--ink);
    }
    .chips{display:flex;gap:8px;flex-wrap:wrap;}
    .chip{padding:6px 10px;border-radius:999px;background:#f1f5f9;color:#334155;font-size:12px;font-weight:700;}
    .chip.hot{background:#fff3e0;color:#c2410c;}
    .chip.cool{background:#e0f2fe;color:#0c4a6e;}
    .chip.good{background:#ecfdf3;color:#166534;}
    .place-card{
      border-radius:18px;border:1px solid var(--line);padding:14px;background:#fff;display:grid;gap:8px;
      box-shadow:0 10px 24px rgba(15,23,42,.08);
    }
    .place-title{font-weight:800;font-size:15px;margin:0;}
    .place-meta{font-size:12px;color:var(--muted);}
    .place-note{font-size:13px;color:#475569;line-height:1.6;}
    .place-actions{display:flex;gap:8px;flex-wrap:wrap;}
    .badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#0f766e;color:#fff;font-size:11px;font-weight:700;}
    .tool-card{
      background:linear-gradient(135deg,#0f766e,#0d9488);color:#fff;border-radius:18px;padding:16px;display:grid;gap:10px;
    }
    .tool-card p{margin:0;font-size:13px;line-height:1.6;color:#e0f2f1;}
    .recommend{
      background:linear-gradient(135deg,#111827,#1f2937);color:#fff;border-radius:20px;padding:18px;display:grid;gap:10px;
    }
    .recommend p{margin:0;color:#cbd5f5;font-size:13px;line-height:1.7;}
    .footer{margin-top:30px;color:#64748b;font-size:12px;display:flex;justify-content:space-between;flex-wrap:wrap;gap:8px;}
    .fade{opacity:0;transform:translateY(8px);animation:fadeUp .8s ease forwards;}
    .fade.delay-1{animation-delay:.1s;}
    .fade.delay-2{animation-delay:.2s;}
    .fade.delay-3{animation-delay:.3s;}
    @keyframes fadeUp{to{opacity:1;transform:translateY(0);}}
    @media(max-width:980px){
      .hero{grid-template-columns:1fr;}
      .grid-3{grid-template-columns:1fr;}
      .grid-2{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="topbar">
      <div class="brand">
        <img src="/img/logo.png" alt="unalomecodes">
        <div>
          <h1>unalomecodes</h1>
          <p>æ³°åœ‹æ—…éŠå³æ™‚å°å·¥å…·ä¸­å¿ƒï½œä¸æ˜¯æŒ‡å—ï¼Œæ˜¯è§£æ±ºç•¶ä¸‹å•é¡Œ</p>
        </div>
      </div>
      <nav class="nav">
        <a class="pill" href="/food-map">ç¾é£Ÿåœ°åœ–</a>
        <a class="pill" href="/quiz">å®ˆè­·ç¥æ¸¬é©—</a>
        <a class="pill" href="/deity">ç¥ç¥‡ä»‹ç´¹</a>
        <a class="pill" href="/shop">å•†åŸ</a>
      </nav>
    </header>

    <section class="hero">
      <div class="hero-card fade">
        <h2 class="hero-title">ğŸ‡¹ğŸ‡­ æ³°åœ‹æ—…éŠå³æ™‚å°å·¥å…·ä¸­å¿ƒ</h2>
        <p class="hero-sub">å¿«é€ŸçŸ¥é“ä½ åœ¨å“ªä¸€å€ã€ç¾åœ¨çš„å¤©æ°£ã€é©åˆçš„ç§»å‹•æ–¹å¼ï¼Œä¸¦åªæ¨è–¦ 3â€“5 å€‹ä½ çœŸçš„æœƒå»çš„åœ°æ–¹ã€‚</p>
        <div class="cta-row">
          <a class="btn primary" href="#today">ä»Šå¤©è¦æ€éº¼é</a>
          <a class="btn ghost" href="/shop">é€²å…¥å•†åŸ</a>
        </div>
      </div>
      <div class="panel fade delay-1">
        <div class="section-title">ğŸ“ ç¾åœ¨åœ¨å“ªä¸€å€</div>
        <div id="locName" style="font-weight:800;font-size:18px;">å®šä½ä¸­â€¦</div>
        <div id="locDetail" class="mini">å¦‚æœå®šä½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸æ“‡åœ°å€ã€‚</div>
        <div class="row">
          <button class="btn ghost" id="locBtn">é‡æ–°å®šä½</button>
          <select id="areaSelect" class="input"></select>
        </div>
      </div>
    </section>

    <section class="grid grid-3" id="today">
      <div class="panel fade delay-1">
        <div class="section-title">ğŸŒ¦ å¤©æ°£ Ã— è¡Œç¨‹å»ºè­°</div>
        <div id="weatherMain" style="font-weight:800;font-size:20px;">â€”</div>
        <div id="weatherAdvice" class="mini">æº–å‚™è¼‰å…¥å³æ™‚å¤©æ°£â€¦</div>
        <div class="chips" id="weatherTags"></div>
      </div>
      <div class="panel fade delay-2">
        <div class="section-title">ğŸ›µ ç¾åœ¨é©åˆæ€éº¼ç§»å‹•</div>
        <div id="transportMain" style="font-weight:800;font-size:18px;">â€”</div>
        <div id="transportAdvice" class="mini">â€”</div>
        <div class="chips" id="transportTags"></div>
      </div>
      <div class="panel fade delay-3">
        <div class="section-title">ğŸ§­ ä»Šæ—¥ç‹€æ…‹å»ºè­°</div>
        <div id="dayPick" class="chips"></div>
        <div class="mini">åªæŒ‘ 3 ä»¶æœ€å€¼å¾—åšçš„äº‹ï¼Œä¸å¡æ»¿è¡Œç¨‹ã€‚</div>
      </div>
    </section>

    <section class="grid grid-2">
      <div class="panel fade delay-1">
        <div class="section-title">âœ¨ é™„è¿‘æ¨è–¦ 3â€“5 å€‹</div>
        <div class="mini">ä¸æ˜¯å¤§å…¨ï¼Œæ˜¯æˆ‘æœƒæ¨è–¦çµ¦æœ‹å‹çš„æ¸…å–®ã€‚</div>
        <div class="grid" id="placeList"></div>
      </div>
      <div class="grid">
        <div class="tool-card fade delay-2">
          <strong>å·¥å…·å…¥å£</strong>
          <p>æƒ³æ›´æ·±å…¥ï¼Ÿä¸€éµå‰å¾€ç¾é£Ÿåœ°åœ–ã€å®ˆè­·ç¥æ¸¬é©—ã€å¯ºå»Ÿè³‡è¨Šèˆ‡è·‘å»ŸæŒ‡å—ã€‚</p>
          <div class="row">
            <a class="btn ghost" href="/food-map" style="background:#fff;color:#0f766e;border:none;">ç¾é£Ÿåœ°åœ–</a>
            <a class="btn ghost" href="/service-guide" style="background:#fff;color:#0f766e;border:none;">è·‘å»ŸæŒ‡å—</a>
          </div>
        </div>
        <div class="recommend fade delay-3">
          <div class="badge">æ¨è–¦è€…æ˜¯æˆ‘</div>
          <strong>ä»Šå¤©åªæƒ³çœæ™‚é–“ï¼Ÿ</strong>
          <p>ç›´æ¥é€²å•†åŸçœ‹æˆ‘ç²¾é¸éçš„æ³°åœ‹ä½›ç‰Œèˆ‡æ—…éŠå¯¦ç”¨å“ã€‚å•†å“æœƒä¾ä½ éœ€è¦çš„å ´æ™¯æ›´æ–°ã€‚</p>
          <a class="btn primary" href="/shop">é€²å…¥å•†åŸ</a>
        </div>
      </div>
    </section>

    <footer class="footer">
      <div>unalomecodes æ³°åœ‹å¯ºå»ŸåŠç¾é£Ÿåœ°åœ–</div>
      <div>å·¥å…·é¦–é ï½œæ›´æ–°ä¸­ï¼šåªæ¨è–¦ 3â€“5 å€‹çœŸå¿ƒæ¸…å–®</div>
    </footer>
  </div>

  <script>
    const AREA_LIST = [
      { id:'siam', name:'Siam / Chit Lom', lat:13.746, lng:100.535, tags:['BTS','å•†å ´'] },
      { id:'sukhumvit', name:'Asok / Sukhumvit', lat:13.737, lng:100.561, tags:['BTS','MRT'] },
      { id:'thonglor', name:'Thonglor / Ekkamai', lat:13.730, lng:100.575, tags:['å’–å•¡','é¤é…’é¤¨'] },
      { id:'silom', name:'Silom / Sathon', lat:13.725, lng:100.532, tags:['BTS','å¤œç”Ÿæ´»'] },
      { id:'oldtown', name:'Old Town / Wat Pho', lat:13.746, lng:100.492, tags:['å¯ºå»Ÿ','æ²³é‚Š'] },
      { id:'riverside', name:'Riverside', lat:13.724, lng:100.491, tags:['æ²³æ™¯','æ¸¡è¼ª'] },
      { id:'ari', name:'Ari / Chatuchak', lat:13.799, lng:100.548, tags:['å’–å•¡','å¸‚é›†'] },
      { id:'chinatown', name:'Yaowarat', lat:13.739, lng:100.513, tags:['å¤œå¸‚','å°åƒ'] }
    ];

    const PLACES = [
      { id:'erawan', name:'å››é¢ä½› Erawan Shrine', type:'å»Ÿ', area:'siam', indoor:false, rating:5, note:'å¸‚ä¸­å¿ƒå¿«é€Ÿè£œé‹ï¼Œä¸€åœˆ 5 åˆ†é˜å°±å®Œæˆã€‚', map:'https://maps.google.com/?q=Erawan+Shrine' },
      { id:'watarun', name:'é„­ç‹å»Ÿ Wat Arun', type:'å»Ÿ', area:'oldtown', indoor:false, rating:4, note:'é»ƒæ˜è¶…ç¾ï¼Œå»ºè­°é¿é–‹æ­£ä¸­åˆã€‚', map:'https://maps.google.com/?q=Wat+Arun' },
      { id:'watpho', name:'è‡¥ä½›å¯º Wat Pho', type:'å»Ÿ', area:'oldtown', indoor:true, rating:4, note:'æœ‰å†·æ°£å€åŸŸï¼Œé©åˆç†±å¤©ä¼‘æ¯ã€‚', map:'https://maps.google.com/?q=Wat+Pho' },
      { id:'iconsiam', name:'ICONSIAM', type:'å•†å ´', area:'riverside', indoor:true, rating:4, note:'ä¸‹é›¨é¦–é¸ï¼Œé£Ÿç‰©é¸æ“‡å¤šã€‚', map:'https://maps.google.com/?q=ICONSIAM' },
      { id:'sathorn', name:'Baan Suan Sathon', type:'å’–å•¡', area:'silom', indoor:false, rating:4, note:'ç¶ æ„æ»¿æ»¿ï¼Œåˆå¾Œå¾ˆæ”¾é¬†ã€‚', map:'https://maps.google.com/?q=Baan+Suan+Sathon' },
      { id:'cataleya', name:'Cataleya Estate', type:'å’–å•¡', area:'sukhumvit', indoor:true, rating:5, note:'æ‹ç…§å¾ˆå¥½çœ‹ï¼Œé¤é»æ°´æº–ç©©ã€‚', map:'https://maps.google.com/?q=Cataleya+Estate' },
      { id:'ari-cafe', name:'Ari å’–å•¡å··', type:'å’–å•¡', area:'ari', indoor:true, rating:4, note:'ä¸€æ¢è¡—å°±æœ‰å¥½å¹¾é–“ç‰¹è‰²å’–å•¡ã€‚', map:'https://maps.google.com/?q=Ari+Bangkok+cafe' },
      { id:'jodd', name:'JODD FAIRS å¤œå¸‚', type:'å¤œå¸‚', area:'sukhumvit', indoor:false, rating:4, note:'æ™šä¸Šæœ€æ–¹ä¾¿çš„å¤œå¸‚ï¼Œäº¤é€šå‹å–„ã€‚', map:'https://maps.google.com/?q=Jodd+Fairs' },
      { id:'yaowarat', name:'è€€è¯åŠ›å¤œå¸‚', type:'å¤œå¸‚', area:'chinatown', indoor:false, rating:5, note:'å°åƒå¯†åº¦æœ€é«˜ï¼Œè¶Šæ™šè¶Šç†±é¬§ã€‚', map:'https://maps.google.com/?q=Yaowarat' },
      { id:'chatuchak', name:'æ°åœ–æ°å…‹å¸‚é›†', type:'å¸‚é›†', area:'ari', indoor:false, rating:4, note:'é€±æœ«é™å®šï¼Œæ€•ç†±è¨˜å¾—æ—©èµ·ã€‚', map:'https://maps.google.com/?q=Chatuchak+Market' },
      { id:'asiatique', name:'Asiatique æ²³æ¿±å¤œå¸‚', type:'å¤œå¸‚', area:'riverside', indoor:false, rating:4, note:'æ²³é‚Šæ•£æ­¥å¾ˆèˆ’æœï¼Œé©åˆæƒ…ä¾¶ã€‚', map:'https://maps.google.com/?q=Asiatique' },
      { id:'lumpini', name:'å€«æŠ«å°¼å…¬åœ’', type:'æ•£æ­¥', area:'silom', indoor:false, rating:3, note:'æ¶¼çˆ½å‚æ™šèµ°ä¸€åœˆæœ€å‰›å¥½ã€‚', map:'https://maps.google.com/?q=Lumpini+Park' }
    ];

    const state = {
      areaId:null,
      coords:null,
      weather:null
    };

    const locName = document.getElementById('locName');
    const locDetail = document.getElementById('locDetail');
    const areaSelect = document.getElementById('areaSelect');
    const locBtn = document.getElementById('locBtn');
    const weatherMain = document.getElementById('weatherMain');
    const weatherAdvice = document.getElementById('weatherAdvice');
    const weatherTags = document.getElementById('weatherTags');
    const transportMain = document.getElementById('transportMain');
    const transportAdvice = document.getElementById('transportAdvice');
    const transportTags = document.getElementById('transportTags');
    const dayPick = document.getElementById('dayPick');
    const placeList = document.getElementById('placeList');

    function kmDistance(a, b){
      const toRad = d => d * Math.PI / 180;
      const R = 6371;
      const dLat = toRad(b.lat - a.lat);
      const dLng = toRad(b.lng - a.lng);
      const lat1 = toRad(a.lat);
      const lat2 = toRad(b.lat);
      const v = Math.sin(dLat/2)**2 + Math.sin(dLng/2)**2 * Math.cos(lat1) * Math.cos(lat2);
      return 2 * R * Math.asin(Math.sqrt(v));
    }

    function detectArea(coords){
      if (!coords) return null;
      let best = null;
      AREA_LIST.forEach(area=>{
        const dist = kmDistance({ lat:coords.lat, lng:coords.lng }, area);
        if (!best || dist < best.dist) best = { id: area.id, dist };
      });
      if (!best || best.dist > 30) return null;
      return best.id;
    }

    function setArea(areaId, reason){
      const area = AREA_LIST.find(a=>a.id===areaId);
      state.areaId = areaId;
      if (area){
        locName.textContent = area.name;
        locDetail.textContent = reason || ('æ ¹æ“šå®šä½åˆ¤æ–·ï½œ' + area.tags.join(' Â· '));
      }else{
        locName.textContent = 'æ›¼è°·å¸‚å€';
        locDetail.textContent = 'å°šæœªç¢ºèªå€åŸŸï¼Œå¯æ‰‹å‹•é¸æ“‡ã€‚';
      }
      updateRecommendations();
    }

    function fillAreaSelect(){
      areaSelect.innerHTML = `<option value="">æ‰‹å‹•é¸æ“‡åœ°å€</option>` +
        AREA_LIST.map(a=>`<option value="${a.id}">${a.name}</option>`).join('');
    }

    function weatherText(code){
      const map = {
        0:'æ™´æœ—',1:'æ™´æ™‚å¤šé›²',2:'å¤šé›²',3:'é™°å¤©',
        51:'æ¯›æ¯›é›¨',53:'å°é›¨',55:'ä¸­é›¨',
        61:'å°é›¨',63:'ä¸­é›¨',65:'å¤§é›¨',
        80:'é™£é›¨',81:'é™£é›¨',82:'è±ªé›¨',
        95:'é›·é›¨'
      };
      return map[code] || 'å¤©æ°£è®ŠåŒ–';
    }

    async function loadWeather(coords){
      if (!coords) return;
      try{
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lng}&current=temperature_2m,precipitation,weather_code,wind_speed_10m&timezone=Asia%2FBangkok`;
        const res = await fetch(url);
        const data = await res.json();
        const cur = data.current || {};
        state.weather = {
          temp: cur.temperature_2m,
          rain: cur.precipitation,
          code: cur.weather_code
        };
        renderWeather();
      }catch(_){
        weatherMain.textContent = 'å¤©æ°£æš«æ™‚ç„¡æ³•å–å¾—';
        weatherAdvice.textContent = 'å…ˆç”¨æˆ‘çš„ç¶“é©—å»ºè­°ï¼šå¤©ç†±é¿å®¤å¤–ï¼Œå‚æ™šå†å®‰æ’æˆ¶å¤–ã€‚';
      }
    }

    function renderWeather(){
      const w = state.weather;
      if (!w){
        weatherMain.textContent = 'â€”';
        return;
      }
      const isRain = Number(w.rain || 0) >= 0.6 || [61,63,65,80,81,82,95].includes(w.code);
      const isHot = Number(w.temp) >= 32;
      const isCool = Number(w.temp) <= 24;
      weatherMain.textContent = `${Math.round(w.temp)}Â°C Â· ${weatherText(w.code)}`;
      if (isRain){
        weatherAdvice.textContent = 'ä¸‹é›¨å»ºè­°ï¼šå®¤å…§å»Ÿã€å’–å•¡åº—æˆ–å•†å ´ï¼Œé¿å…é è·æ­¥è¡Œã€‚';
      }else if (isHot){
        weatherAdvice.textContent = 'å¤ªç†±å»ºè­°ï¼šå…ˆå»å†·æ°£å’–å•¡æˆ–å•†å ´ï¼Œå‚æ™šå†è·‘æˆ¶å¤–ã€‚';
      }else if (isCool){
        weatherAdvice.textContent = 'å¤©æ°£èˆ’æœï¼šå®‰æ’æ²³é‚Šæ•£æ­¥æˆ–æˆ¶å¤–å¯ºå»Ÿã€‚';
      }else{
        weatherAdvice.textContent = 'æ°£å€™ç©©å®šï¼Œé©åˆå®‰æ’ 2â€“3 å€‹çŸ­è¡Œç¨‹ã€‚';
      }
      weatherTags.innerHTML = '';
      const tags = [];
      if (isRain) tags.push({ text:'é›¨å¤©æ¨¡å¼', cls:'chip cool' });
      if (isHot) tags.push({ text:'é«˜æº«æ¨¡å¼', cls:'chip hot' });
      if (!isRain && !isHot) tags.push({ text:'è¡Œç¨‹è‡ªç”±', cls:'chip good' });
      tags.forEach(t=>{
        const span = document.createElement('span');
        span.className = t.cls;
        span.textContent = t.text;
        weatherTags.appendChild(span);
      });
    }

    function buildTransportAdvice(){
      const w = state.weather || {};
      const hour = new Date().getHours();
      const isLate = hour >= 22 || hour <= 6;
      const isRain = Number(w.rain || 0) >= 0.6;
      let main = 'BTS / MRT';
      let tip = 'å¸‚å€ç§»å‹•é¦–é¸è»Œé“ï¼Œç¯€çœå¡è»Šæ™‚é–“ã€‚';
      if (isLate){
        main = 'Grab / Bolt / è¨ˆç¨‹è»Š';
        tip = 'å¤œæ™šå»ºè­°å«è»Šç§»å‹•ï¼Œå®‰å…¨åˆçœé«”åŠ›ã€‚';
      }else if (isRain){
        main = 'BTS / MRT + Grab';
        tip = 'é›¨å¤©å…ˆæ­è»Œé“ï¼Œå†ç”¨å«è»Šè£œæœ€å¾Œä¸€æ®µã€‚';
      }
      transportMain.textContent = main;
      transportAdvice.textContent = 'æˆ‘çš„å»ºè­°ï¼š' + tip;
      transportTags.innerHTML = '';
      ['BTS','MRT','Grab','Bolt','è¨ˆç¨‹è»Š'].forEach(name=>{
        const span = document.createElement('span');
        span.className = 'chip';
        span.textContent = name;
        if (main.includes(name)) span.classList.add('good');
        transportTags.appendChild(span);
      });
    }

    function buildDayPicks(){
      const w = state.weather || {};
      const hour = new Date().getHours();
      const picks = [];
      const isRain = Number(w.rain || 0) >= 0.6;
      const isHot = Number(w.temp || 0) >= 32;
      if (isRain){
        picks.push('å®¤å…§å»Ÿéœå¿ƒ');
        picks.push('å’–å•¡åº—ä¼‘æ¯');
        picks.push('å•†å ´åƒé£¯');
      }else if (isHot){
        picks.push('å†·æ°£å’–å•¡å»³');
        picks.push('å‚æ™šå¤œå¸‚');
        picks.push('æ²³é‚Šæ•£æ­¥');
      }else{
        picks.push('é™„è¿‘å¯ºå»Ÿ');
        picks.push('å°å··å’–å•¡');
        picks.push(hour >= 17 ? 'å¤œå¸‚å°åƒ' : 'åŸå¸‚æ•£æ­¥');
      }
      dayPick.innerHTML = '';
      picks.slice(0,3).forEach(text=>{
        const span = document.createElement('span');
        span.className = 'chip';
        span.textContent = text;
        dayPick.appendChild(span);
      });
    }

    function pickPlaces(){
      const areaId = state.areaId;
      const w = state.weather || {};
      const isRain = Number(w.rain || 0) >= 0.6;
      const pool = PLACES.filter(p => !areaId || p.area === areaId);
      const fallback = PLACES.filter(p => p.area !== areaId);
      const list = pool.length ? pool : fallback;
      const picked = [];
      ['å»Ÿ','å’–å•¡','å¤œå¸‚','å¸‚é›†'].forEach(type=>{
        const item = list.find(p=>p.type === type && !picked.includes(p));
        if (item) picked.push(item);
      });
      list.sort((a,b)=> b.rating - a.rating).forEach(item=>{
        if (picked.length >= 5) return;
        if (!picked.includes(item)){
          if (isRain && !item.indoor && item.type === 'å¤œå¸‚') return;
          picked.push(item);
        }
      });
      return picked.slice(0,5);
    }

    function updateRecommendations(){
      buildTransportAdvice();
      buildDayPicks();
      const list = pickPlaces();
      placeList.innerHTML = '';
      list.forEach(place=>{
        const card = document.createElement('div');
        card.className = 'place-card';
        card.innerHTML = `
          <div class="badge">${place.type}</div>
          <div class="place-title">${place.name}</div>
          <div class="place-meta">${AREA_LIST.find(a=>a.id===place.area)?.name || 'æ›¼è°·'}</div>
          <div class="place-note">${place.note}</div>
          <div class="place-actions">
            <a class="btn ghost" href="${place.map}" target="_blank" rel="noopener">åœ°åœ–å°èˆª</a>
            <a class="btn ghost" href="/food-map">æŸ¥çœ‹æ›´å¤š</a>
          </div>
        `;
        placeList.appendChild(card);
      });
    }

    function applyCoords(coords, reason){
      state.coords = coords;
      const areaId = detectArea(coords);
      setArea(areaId, reason);
      loadWeather(coords);
    }

    function locateNow(){
      if (!navigator.geolocation){
        locDetail.textContent = 'æ­¤è£ç½®ä¸æ”¯æ´å®šä½ï¼Œè«‹æ‰‹å‹•é¸æ“‡åœ°å€ã€‚';
        return;
      }
      locName.textContent = 'å®šä½ä¸­â€¦';
      navigator.geolocation.getCurrentPosition(
        pos=>{
          const coords = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          applyCoords(coords, 'æ ¹æ“šå®šä½åˆ¤æ–·');
        },
        ()=>{
          locName.textContent = 'å®šä½å¤±æ•—';
          locDetail.textContent = 'è«‹æ‰‹å‹•é¸æ“‡åœ°å€ã€‚';
        },
        { enableHighAccuracy:true, timeout:8000 }
      );
    }

    fillAreaSelect();
    areaSelect.addEventListener('change', (ev)=>{
      const val = ev.target.value;
      if (!val) return;
      const area = AREA_LIST.find(a=>a.id===val);
      if (area){
        applyCoords({ lat: area.lat, lng: area.lng }, 'æ‰‹å‹•é¸æ“‡åœ°å€');
      }
    });
    locBtn.addEventListener('click', locateNow);
    locateNow();
  </script>
</body>
</html>
