<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>æœå‹™å‹å•†å“ï½œunalomecodes</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
body.service-view{background:var(--bg);color:var(--fg);}
.line-btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 18px;border-radius:999px;background:#16a34a;color:#fff;font-weight:700;text-decoration:none;box-shadow:0 6px 14px rgba(22,163,74,.35);}
.line-btn span{font-size:18px;}
.service-hero{margin-top:14px;background:var(--card);border:1px solid var(--line);border-radius:18px;padding:22px;box-shadow:var(--shadow);}
.service-hero h1{margin:0;font-size:26px;font-weight:800;}
.svc-head{display:flex;justify-content:space-between;align-items:center;gap:12px;margin:22px 0 12px;}
.svc-head .title{font-weight:800;font-size:18px;}
.service-grid{margin-top:16px;}
.service-grid .card .meta{display:flex;gap:8px 10px;flex-wrap:wrap;font-size:12px;color:var(--muted);margin:0 0 8px;line-height:1.4;}
.service-grid .card .meta.meta-limited{margin-bottom:6px;}
.service-grid .card .meta .badge{display:inline-flex;align-items:center;gap:4px;white-space:nowrap;}
.service-grid .card .pic img{width:100%;height:100%;object-fit:cover !important;object-position:center;}
.svc-tags{margin:8px 0 10px;}
.service-grid .card .price{font-size:18px;margin-top:6px;}
.service-grid .card .cta .btn{font-size:14px;}
.svc-dialog{border:none;border-radius:18px;padding:0;background:var(--card);color:var(--fg);box-shadow:0 30px 60px rgba(15,23,42,.3);border:1px solid var(--line);}
.svc-dialog .closeBar{border-bottom:1px solid var(--line);}
.svc-dialog .dlgBody{display:grid;grid-template-columns:1fr;gap:18px;padding:18px;}
@media(min-width:820px){.svc-dialog .dlgBody{grid-template-columns:1fr 1fr;}}
.svc-dialog .svc-includes{border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:12px;list-style:disc;padding-left:22px;background:#f9fafb;}
.svc-dialog .svc-includes li{margin-bottom:6px;color:#374151;}
.svc-ig{margin-top:12px;}
.svc-ig iframe{width:100%;border:none;border-radius:16px;min-height:420px;background:#fff;}
.thumb-ig{border:1px dashed var(--line);border-radius:12px;padding:18px;text-align:center;font-weight:700;color:#2563eb;background:#eef2ff;cursor:pointer;display:flex;align-items:center;justify-content:center;}
#svcRvList > .rvItem:last-child{border-bottom:none;}
#svcRvList:empty::before{content:"é‚„æ²’æœ‰äººåˆ†äº«æ•…äº‹ï¼Œæˆç‚ºç¬¬ä¸€å€‹åˆ†äº«çš„äººå§ï¼";display:block;padding:20px;text-align:center;color:#94a3b8;font-size:14px;border:1px dashed #e5e7eb;}
#sideDeities .list a.line-btn{display:flex;border:none;background:#16a34a;color:#fff;font-weight:700;justify-content:center;align-items:center;gap:8px;padding:10px 18px;box-shadow:0 6px 14px rgba(22,163,74,.35);}
.policy-link{color:#2563eb;text-decoration:underline;cursor:pointer;font-weight:600;}
.policy-dialog{border:none;border-radius:18px;padding:0;background:#fff;color:#0f172a;max-width:640px;width:95%;box-shadow:0 30px 60px rgba(15,23,42,.35);}
.dialog-fallback-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.55);backdrop-filter:blur(6px);z-index:1000;display:none;}
.dialog-fallback-backdrop.active{display:block;}
dialog[data-fallback-open]{display:block;}
.policy-dialog[data-fallback-open]{position:fixed;z-index:1001;top:50%;left:50%;transform:translate(-50%,-50%);border:1px solid rgba(15,23,42,.1);}
.policy-dialog header{padding:18px;border-bottom:1px solid #e5e7eb;font-weight:800;font-size:18px;}
.policy-dialog .body{padding:18px;line-height:1.7;font-size:14px;max-height:70vh;overflow:auto;}
.policy-dialog footer{padding:0 18px 18px;text-align:right;}
.svc-dialog .svc-options{display:flex;flex-direction:column;gap:6px;margin-top:10px;}
.svc-dialog .svc-options label{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
  border:1px solid var(--line);
  border-radius:10px;
  padding:6px 10px;
  font-size:14px;
  background:#f8fafc;
  width:100%;
}
.svc-dialog .svc-options label span{
  display:flex;
  align-items:center;
  gap:6px;
  flex:1;
  white-space:normal;
}
.svc-dialog .svc-options input{margin:0;flex-shrink:0;}
.svc-stepper{display:flex;gap:8px;justify-content:center;padding:14px;border-bottom:1px solid var(--line);background:linear-gradient(135deg,rgba(24,161,104,.08),rgba(16,149,214,.08));}
.svc-stepper span{display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:999px;border:1px solid var(--line);font-size:13px;color:#6b7280;font-weight:700;background:#fff;}
.svc-stepper span.active{background:#16a34a;color:#fff;border-color:#16a34a;box-shadow:0 8px 20px rgba(22,163,74,.35);}
.svc-stepper span.done{background:#bbf7d0;color:#166534;border-color:#86efac;}
.svc-step-content{display:none;flex-direction:column;gap:16px;padding:18px;}
.svc-step-content.active{display:flex;}
.svc-step-title{font-weight:800;font-size:18px;}
.svc-form-section{display:grid;gap:12px;}
.svc-bank-box{border:1px solid var(--line);border-radius:14px;padding:14px;background:#f8fafc;display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;}
.svc-bank-box .info{font-size:14px;color:#0f172a;font-weight:700;}
.svc-bank-box .info span{display:block;font-size:12px;color:#6b7280;font-weight:600;}
.svc-bank-copy{border:1px solid var(--line);background:#fff;border-radius:999px;padding:6px 12px;font-weight:700;font-size:13px;cursor:pointer;}
.svc-bank-hint{font-size:12px;color:#6b7280;line-height:1.6;}
.svc-upload-hint{font-size:12px;color:#ef4444;}
.svc-step-actions{display:flex;justify-content:flex-end;gap:10px;flex-wrap:wrap;}
.svc-step-actions .btn{min-width:120px;}
.svc-success-icon{width:64px;height:64px;border-radius:50%;background:#dcfce7;color:#166534;display:flex;align-items:center;justify-content:center;font-size:32px;margin:0 auto;}
.svc-step3-card{border:1px solid var(--line);border-radius:14px;background:#f8fafc;padding:14px;display:grid;gap:8px;font-size:14px;color:#374151;}
.svc-step3-card strong{font-size:16px;}
.svc-cart-item{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--line);border-radius:14px;padding:10px;gap:12px;background:#fff;}
.svc-cart-item .info{display:flex;gap:10px;align-items:center;flex:1;}
.svc-cart-item img{width:56px;height:56px;object-fit:cover;border-radius:12px;}
.svc-cart-item .meta{font-size:12px;color:#6b7280;margin-top:2px;}
.svc-cart-item .price{font-weight:800;margin-right:10px;}
.svc-cart-remove{border:1px solid var(--line);background:#fff;border-radius:10px;padding:6px 12px;font-size:13px;font-weight:700;cursor:pointer;}
.svc-cart-actions{padding:0 18px 18px;display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap;margin-top:4px;}
.svc-cart-actions .btn{flex:1;min-width:120px;}
.btn.loading{position:relative;pointer-events:none;}
.btn.loading::after{
  content:"";
  position:absolute;
  right:10px;
  width:14px;height:14px;
  border-radius:50%;
  border:2px solid rgba(255,255,255,.6);
  border-top-color:transparent;
  animation:spin .8s linear infinite;
}
@keyframes spin{from{transform:rotate(0deg);}to{transform:rotate(360deg);}}
@media(max-width:560px){
  .svc-cart-item{flex-direction:column;align-items:flex-start;}
  .svc-cart-item .price{margin-right:0;}
  .svc-cart-actions .btn{flex:1 0 100%;}
}
#svcCartForm{padding:0;}
#svcCartForm section{padding:18px;display:grid;gap:12px;}
#svcCartForm label{display:grid;gap:4px;font-size:13px;color:#374151;font-weight:700;}
#svcCartForm input,#svcCartForm textarea,#svcCartForm select{padding:10px 12px;border:1px solid var(--line);border-radius:12px;font-size:14px;}
#svcCartForm textarea{min-height:110px;resize:vertical;}
.svc-summary{background:#f8fafc;border:1px solid var(--line);border-radius:14px;padding:14px;margin:18px;display:flex;justify-content:space-between;align-items:center;gap:10px;}
.svc-summary strong{font-size:18px;}
#svcLookup{border:none;border-radius:16px;padding:0;background:var(--card);border:1px solid var(--line);box-shadow:0 20px 50px rgba(15,23,42,.35);}
#svcLookup header{padding:18px;border-bottom:1px solid var(--line);}
#svcLookup form{padding:18px;display:grid;gap:12px;}
#svcLookup label{display:grid;gap:6px;font-size:13px;color:#374151;font-weight:600;}
#svcLookup input{padding:10px 12px;border:1px solid var(--line);border-radius:12px;}
#svcLookup .actions{padding:0 18px 18px;display:flex;justify-content:flex-end;gap:10px;}
#svcLookupResult{padding:0 18px 18px;}
#svcLookupCards .lookup-card{border:1px solid var(--line);border-radius:12px;padding:12px;background:#f8fafc;}
#svcSuccess .svc-success-body{padding:20px;display:grid;gap:12px;}
#svcSuccess .svc-success-body .order-id{font-size:22px;font-weight:800;}
#svcSuccess footer{padding:0 20px 20px;display:flex;justify-content:flex-end;gap:10px;}
.guardian-badge{display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:999px;background:linear-gradient(135deg,#0f172a,#111827);border:1px solid rgba(148,163,184,0.35);color:#e2e8f0;box-shadow:0 12px 24px rgba(15,23,42,0.25);}
.guardian-badge img{width:28px;height:28px;object-fit:contain;filter:drop-shadow(0 2px 4px rgba(0,0,0,.2));}
.guardian-meta{display:flex;flex-direction:column;gap:2px;font-size:12px;}
.guardian-meta strong{font-size:13px;font-weight:700;color:#f8fafc;}
.fortune-btn{margin-top:2px;background:linear-gradient(135deg,#f59e0b,#f97316);color:#0b1120;border:none;border-radius:999px;padding:4px 10px;font-size:11px;font-weight:700;cursor:pointer;box-shadow:0 6px 14px rgba(249,115,22,.35);}
.fortune-btn:disabled{opacity:.6;cursor:not-allowed;box-shadow:none;}

.fortune-dialog{border:none;border-radius:18px;padding:0;max-width:560px;width:92%;background:#0b1022;color:#e5e7eb;box-shadow:0 24px 60px rgba(0,0,0,.45);}
.fortune-shell{padding:20px;display:grid;gap:16px;background:
  radial-gradient(circle at 20% 10%, rgba(253,224,71,.08), transparent 38%),
  radial-gradient(circle at 80% 0%, rgba(56,189,248,.12), transparent 40%),
  #0b1022;border-radius:18px;border:1px solid rgba(148,163,184,0.2);}
.fortune-head{display:flex;align-items:center;justify-content:space-between;gap:12px;}
.fortune-title{font-size:18px;font-weight:800;letter-spacing:.5px;}
.fortune-date{font-size:12px;color:#94a3b8;}
.fortune-close{border:none;background:rgba(255,255,255,.1);color:#e2e8f0;border-radius:999px;width:28px;height:28px;cursor:pointer;}
.fortune-loading{padding:16px;border-radius:14px;border:1px dashed rgba(148,163,184,.3);background:rgba(15,23,42,.55);color:#cbd5f5;font-size:13px;text-align:center;}
.fortune-error{padding:12px;border-radius:12px;background:rgba(248,113,113,.12);border:1px solid rgba(248,113,113,.4);color:#fecaca;font-size:13px;}
.fortune-card{padding:16px;border-radius:16px;background:linear-gradient(135deg,#111827,#0f172a);border:1px solid rgba(94,234,212,.25);box-shadow:0 16px 36px rgba(0,0,0,.35);animation:fortuneFlip .6s ease;}
.fortune-card{position:relative;overflow:hidden;transform-style:preserve-3d;}
.fortune-stars{font-size:16px;letter-spacing:2px;color:#fbbf24;margin-bottom:6px;}
.fortune-summary{font-size:16px;font-weight:800;color:#f8fafc;margin-bottom:10px;}
.fortune-section{margin-top:10px;padding-top:10px;border-top:1px solid rgba(148,163,184,.18);}
.fortune-label{font-size:12px;letter-spacing:1px;color:#94a3b8;margin-bottom:6px;}
.fortune-text{font-size:14px;line-height:1.7;color:#e2e8f0;}
.fortune-meta{margin-top:12px;display:flex;flex-wrap:wrap;gap:6px;font-size:11px;color:#cbd5f5;}
.fortune-meta span{padding:4px 8px;border-radius:999px;border:1px solid rgba(148,163,184,.3);background:rgba(15,23,42,.6);}
.fortune-actions{margin-top:14px;display:flex;justify-content:flex-end;}
.fortune-share-btn{border:none;border-radius:999px;padding:8px 14px;font-size:12px;font-weight:700;color:#0b1120;background:linear-gradient(135deg,#fde68a,#f59e0b);box-shadow:0 10px 20px rgba(245,158,11,.3);cursor:pointer;}
.fortune-share-btn:disabled{opacity:.6;cursor:not-allowed;box-shadow:none;}
@keyframes fortuneFlip{from{transform:rotateY(20deg) scale(.98);opacity:.2;}to{transform:rotateY(0deg) scale(1);opacity:1;}}
@media(max-width:560px){
  .guardian-badge{justify-content:center;text-align:center;}
  .guardian-meta{align-items:center;}
  .guardian-badge{margin:6px auto 0;}
}
  </style>
</head>
<body class="service-view">
  <div class="wrap service-page">
    <div class="top service-top">
      <div class="brand">
        <img src="https://i.ibb.co/7mtppQQ/logo.jpg" alt="">
        <div>
          <div class="t1">æ³°åœ‹å¯ºå»Ÿmap Â©ï¸ unalomecodes</div>
          <div class="t2">æœå‹™å‹å•†å“å°ˆå€</div>
        </div>
      </div>
      <div class="top-actions-right">
        <div class="member-menu">
          <button type="button" id="memberMenuBtnSvc">æœƒå“¡ä¸­å¿ƒ â–¾</button>
          <div class="member-menu-panel" id="memberMenuPanelSvc">
            <a href="#" data-profile>åŸºæœ¬è³‡æ–™</a>
            <a href="/account-coupons.html">æˆ‘çš„å„ªæƒ åˆ¸</a>
            <a href="/account-orders.html">æˆ‘çš„è¨‚å–®</a>
            <a href="/account-store.html">é–€å¸‚é è¨­</a>
          </div>
        </div>
        <div class="auth-widget" data-auth-widget>
          <span class="auth-status" data-auth-status>ç™»å…¥ç‹€æ…‹è¼‰å…¥ä¸­â€¦</span>
          <button type="button" class="auth-btn" data-auth-btn>ç™»å…¥æœƒå“¡</button>
        </div>
        <div id="guardianBadgeSvc" class="guardian-badge" style="display:none;"></div>
      </div>
    </div>

    <dialog id="fortuneDialog" class="fortune-dialog">
      <div class="fortune-shell">
        <div class="fortune-head">
          <div>
            <div class="fortune-title">ä»Šæ—¥å°ˆå±¬æ—¥ç±¤</div>
            <div class="fortune-date" id="fortuneDate">â€”</div>
          </div>
          <button type="button" class="fortune-close" id="fortuneClose">âœ•</button>
        </div>
        <div class="fortune-body">
          <div id="fortuneLoading" class="fortune-loading">æ­£åœ¨ç¿»ç‰Œä¸­â€¦</div>
          <div id="fortuneError" class="fortune-error" style="display:none;"></div>
          <div id="fortuneCard" class="fortune-card" style="display:none;">
            <div class="fortune-stars" id="fortuneStars"></div>
            <div class="fortune-summary" id="fortuneSummary"></div>
            <div class="fortune-section">
              <div class="fortune-label">ç”Ÿæ´»å°å»ºè­°</div>
              <div class="fortune-text" id="fortuneAdvice"></div>
            </div>
            <div class="fortune-section">
              <div class="fortune-label" id="fortuneRitualLabel">å®ˆè­·ç¥æƒ³å°ä½ èªª</div>
              <div class="fortune-text" id="fortuneRitual"></div>
            </div>
            <div class="fortune-meta" id="fortuneMeta"></div>
            <div class="fortune-actions">
              <button type="button" class="fortune-share-btn" id="fortuneShareBtn">è‡ªå‹•æˆªåœ–åˆ†äº«</button>
            </div>
          </div>
        </div>
      </div>
    </dialog>

    <div class="store service-layout">
      <aside id="sideDeities">
        <div class="side-cart">
          <button id="cartFab" type="button" title="æŸ¥çœ‹è³¼ç‰©è»Š"><span class="lbl">æœå‹™è³¼ç‰©è»Š</span><span id="cartBadge">0</span></button>
        </div>
        <div class="tools-box">
          <h4>å¸¸ç”¨é€£çµ</h4>
          <div class="list">
            <a href="/shop.html">è¿”å›å•†å“é¤¨</a>
            <a href="#" id="linkServiceLookup">ç¥ˆç¦é€²åº¦æŸ¥è©¢</a>
            <button id="svcHotToggle" class="side-cat-btn" type="button">ç†±è³£ä¸­æœå‹™</button>
            <a class="line-btn" href="https://line.me/R/ti/p/@427oaemj" target="_blank" rel="noopener"><span>ğŸ’¬</span>å®˜æ–¹LINEå®¢æœ</a>
          </div>
        </div>
      </aside>

      <div class="main service-main">
        <section id="svcHotSection" class="hot-section" style="display:none;">
          <div class="hot-head">
            <div class="hot-title">ç†±è³£ä¸­æœå‹™</div>
            <div class="hot-sub">äººæ°£æ’è¡Œ</div>
          </div>
          <div id="svcHotList" class="grid hot-grid service-grid"></div>
        </section>
        <section>
          <div id="svcList" class="grid service-grid">
            <div id="svcListEmpty">è¼‰å…¥ä¸­â€¦</div>
          </div>
        </section>
      </div>
    </div>

    <div class="footer">
      <strong>è¯çµ¡æˆ‘å€‘</strong><br>
      bkkaiwei@gmail.com<br>
      å®¢æœLINE official @427oaemj<br>
      2025Â©unalomecodes ï½œ <a href="#" id="privacyLink" class="policy-link">éš±ç§æ¬Šæ”¿ç­–</a>
    </div>
  </div>

  <dialog id="privacyDialog" class="policy-dialog">
    <header>éš±ç§æ¬Šæ”¿ç­–</header>
    <div class="body">
      <p>æ„Ÿè¬æ‚¨ä½¿ç”¨ unalomecodes æœå‹™å•†å“ï¼Œæˆ‘å€‘éµå¾ªä¸€èˆ¬é›»å•†å¹³å°å°å€‹è³‡èˆ‡äº¤æ˜“è³‡æ–™çš„ä¿è­·åšæ³•ï¼Œä»¥ä¸‹æ¢åˆ—æœå‹™å‹å•†å“å°ˆå€çš„å€‹è³‡ä½¿ç”¨æ–¹å¼ï¼š</p>
      <ol>
        <li><strong>è’é›†ä¾†æºï¼š</strong>æ‚¨é€éä¸‹å–®è¡¨å–®ã€ç¥ˆç¦é€²åº¦æŸ¥è©¢ã€é¡§å®¢æ•…äº‹åˆ†äº«æ‰€æä¾›çš„å§“åã€è¯çµ¡æ–¹å¼ã€ç¥ˆç¦éœ€æ±‚èˆ‡ä¸Šå‚³æª”æ¡ˆã€‚</li>
        <li><strong>Google ç™»å…¥ï¼š</strong>è‹¥ä»¥ Google å¸³è™Ÿç™»å…¥ï¼Œæˆ‘å€‘åƒ…å–å¾—æ‚¨çš„å§“åã€Emailã€Google å¸³è™Ÿè­˜åˆ¥ç¢¼èˆ‡é ­åƒï¼Œç”¨æ–¼èº«åˆ†é©—è­‰ã€ç¶­æŒç™»å…¥ç‹€æ…‹ã€é¡¯ç¤ºæœƒå“¡è³‡æ–™èˆ‡åˆ¤æ–·ç®¡ç†å“¡ç™½åå–®ã€‚ç™»å…¥è³‡è¨Šèˆ‡æœƒè©± Cookie åƒ…å„²å­˜åœ¨æœ¬ç«™åŠå—æ§ç³»çµ±ï¼Œä¸èˆ‡ç¬¬ä¸‰æ–¹å…±äº«ã€‚</li>
        <li><strong>LINE ç™»å…¥ï¼š</strong>è‹¥ä»¥ LINE å¸³è™Ÿç™»å…¥ï¼Œæˆ‘å€‘åƒ…å–å¾—æ‚¨çš„ LINE å¸³è™Ÿè­˜åˆ¥ç¢¼ã€é¡¯ç¤ºåç¨±ã€Emailï¼ˆè‹¥æˆæ¬Šï¼‰èˆ‡é ­åƒï¼Œç”¨æ–¼èº«åˆ†é©—è­‰ã€ç¶­æŒç™»å…¥ç‹€æ…‹ã€é¡¯ç¤ºæœƒå“¡è³‡æ–™èˆ‡åˆ¤æ–·ç®¡ç†å“¡ç™½åå–®ã€‚ç™»å…¥è³‡è¨Šèˆ‡æœƒè©± Cookie åƒ…å„²å­˜åœ¨æœ¬ç«™åŠå—æ§ç³»çµ±ï¼Œä¸èˆ‡ç¬¬ä¸‰æ–¹å…±äº«ã€‚</li>
        <li><strong>ä½¿ç”¨ç›®çš„ï¼š</strong>ç”¨æ–¼è¯çµ¡å®¢æˆ¶ã€æ ¸å°åŒ¯æ¬¾ã€é€²è¡Œç¥ˆç¦æµç¨‹ã€å‡ºè²¨æˆ–å”®å¾Œæœå‹™ï¼Œä»¥åŠå¯„é€ç¥ˆç¦æˆæœæˆ–å®¢æœé€šçŸ¥ã€‚</li>
        <li><strong>è³‡æ–™ä¿å­˜ï¼š</strong>è¨‚å–®èˆ‡åŒ¯æ¬¾è³‡è¨Šæœƒå„²å­˜åœ¨èˆ‡å¯¦é«”å•†å“ç›¸åŒçš„ç³»çµ±ï¼ˆCloudflare / Google Workspace ç­‰ï¼‰ï¼›ç¥ˆç¦æˆæœç…§ç‰‡åƒ…ç”¨æ–¼é€šçŸ¥æœ¬äººï¼Œä¸æœƒå…¬é–‹çµ¦ç¬¬ä¸‰æ–¹ã€‚</li>
        <li><strong>åˆ†äº«å°è±¡ï¼š</strong>åƒ…åœ¨å¿…è¦æ™‚æä¾›çµ¦å”åŠ©ç¥ˆç¦çš„è€å¸«èˆ‡åˆä½œç¥å£‡äººå“¡ï¼Œä¸æœƒè½‰å”®æˆ–æä¾›çµ¦å…¶ä»–å…¬å¸ã€‚è‹¥æœ‰é‡‘æµæˆ–ç‰©æµæœå‹™ï¼Œåƒ…æä¾›å¿…è¦è³‡è¨Šã€‚</li>
        <li><strong>è³‡æ–™å®‰å…¨ï¼š</strong>æˆ‘å€‘ä½¿ç”¨èˆ‡å•†åŸä¸€è‡´çš„åŠ å¯†é€£ç·šèˆ‡å­˜å–æ¬Šé™åˆ¶åº¦ï¼Œä¸¦å®šæœŸæ¸…æŸ¥èˆ‡åˆªé™¤ä¸å†éœ€è¦çš„å€‹è³‡ã€‚</li>
        <li><strong>æ‚¨çš„æ¬Šåˆ©ï¼š</strong>æ‚¨å¯é€éå®˜æ–¹ LINE æˆ– email è¦æ±‚æŸ¥è©¢ã€ä¸‹è¼‰ã€æ›´æ–°æˆ–åˆªé™¤å€‹è³‡ã€‚æˆ‘å€‘æœƒæ–¼åˆç†æ™‚é–“å…§å›è¦†ä¸¦å®Œæˆä½œæ¥­ã€‚</li>
      </ol>
      <p>ä½¿ç”¨æœ¬æœå‹™å³è¡¨ç¤ºæ‚¨åŒæ„ä¸Šè¿°æ¢æ¬¾ã€‚å¦‚æœ‰ç–‘å•ï¼Œæ­¡è¿é€éå®˜æ–¹ LINE å®¢æœè¯ç¹«ã€‚</p>
    </div>
    <footer>
      <button type="button" class="btn" id="privacyClose">é—œé–‰</button>
    </footer>
  </dialog>

  <dialog id="profileDialogSvc" class="policy-dialog">
    <header>åŸºæœ¬è³‡æ–™</header>
    <div class="body">
      <label>å§“å</label>
      <input id="profileNameSvc" type="text">
      <label>Email</label>
      <input id="profileEmailSvc" type="email">
      <label>æ‰‹æ©Ÿè™Ÿç¢¼</label>
      <input id="profilePhoneSvc" type="tel" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼">
      <p class="muted" style="font-size:12px;margin-top:8px;">å„²å­˜å¾Œï¼Œå¯¦é«”å•†å“èˆ‡æœå‹™å•†å“çµå¸³æœƒè‡ªå‹•å¸¶å…¥é€™ä¸‰é …è³‡æ–™ã€‚</p>
      <div id="profileStatusSvc" style="color:#ef4444;font-size:13px;min-height:18px;"></div>
    </div>
    <footer>
      <button type="button" class="btn" id="profileCloseSvc">å–æ¶ˆ</button>
      <button type="button" class="btn primary" id="profileSaveSvc">å„²å­˜</button>
    </footer>
  </dialog>

  <dialog id="svcLookup">
    <header>
      <div style="font-weight:800;font-size:18px;">ç¥ˆç¦é€²åº¦æŸ¥è©¢</div>
      <p style="margin:6px 0 0;color:#6b7280;font-size:13px;">è¼¸å…¥æ‰‹æ©Ÿä¸¦æ­é…è¨‚å–®ç·¨è™Ÿæœ«äº”ç¢¼ï¼ˆè‹±æ•¸ï¼‰æˆ–åŒ¯æ¬¾å¸³è™Ÿæœ«äº”ç¢¼ï¼Œå³å¯æŸ¥çœ‹æœå‹™æœ€æ–°ç‹€æ…‹ã€‚</p>
    </header>
    <form id="svcLookupForm">
      <label>
        æ‰‹æ©Ÿè™Ÿç¢¼
        <input type="tel" name="phone" required placeholder="è«‹è¼¸å…¥ä¸‹å–®æ™‚çš„é›»è©±" pattern="09\d{8}">
      </label>
      <label>
        è¨‚å–®ç·¨è™Ÿæœ«äº”ç¢¼ï¼ˆè‹±æ•¸ï¼‰
        <input type="text" name="orderDigits" inputmode="text" pattern="[A-Za-z0-9]{5}" placeholder="A1B2C">
      </label>
      <label>
        åŒ¯æ¬¾å¸³è™Ÿæœ«äº”ç¢¼
        <input type="text" name="bankDigits" inputmode="numeric" pattern="\d{5}" placeholder="12345">
      </label>
      <div class="actions">
        <button type="button" class="btn" id="svcLookupClose">é—œé–‰</button>
        <button type="submit" class="btn primary">æŸ¥è©¢</button>
      </div>
      <p id="svcLookupHint" style="margin:0;font-size:12px;color:#94a3b8;">æŸ¥è©¢çµæœè¼‰å…¥å¾Œæœƒé¡¯ç¤ºæ–¼ä¸‹æ–¹ã€‚</p>
    </form>
    <div id="svcLookupResult" style="display:none;">
      <div style="font-weight:700;margin-bottom:6px;">æŸ¥è©¢çµæœ</div>
      <div id="svcLookupCards" style="display:flex;flex-direction:column;gap:10px;"></div>
    </div>
  </dialog>

  <dialog id="svcDetail" class="svc-dialog">
    <div class="closeBar">
      <strong id="svcDetailTitle">æœå‹™åç¨±</strong>
      <button id="svcDetailClose" class="xbtn" type="button">âœ•</button>
    </div>
    <div class="dlgBody">
      <div>
        <div class="bigBox">
          <img id="svcDetailHero" class="big" alt="">
        </div>
        <div class="thumbs" id="svcDetailGallery"></div>
        <div id="svcDetailInstagram" class="svc-ig" style="display:none;"></div>
      </div>
      <div>
        <div style="font-weight:700;color:#6b7280;margin-bottom:4px;">æœå‹™å…§å®¹</div>
        <div class="dlgTags svc-tags">
          <span id="svcDetailLimited" class="dlgTag dlgTag--limited" style="display:none;"></span>
          <span id="svcDetailRemaining" class="dlgTag dlgTag--remaining" style="display:none;"></span>
        </div>
        <div id="svcDetailDesc" style="font-size:14px;line-height:1.7;border:1px solid var(--line);border-radius:12px;padding:12px;white-space:pre-wrap;max-height:220px;overflow:auto;">æœå‹™èªªæ˜</div>
        <ul id="svcDetailIncludes" class="svc-includes">
          <li>è Ÿç‡­ç¥ˆè«‹</li>
        </ul>
        <div id="svcDetailOptionsWrap" style="margin-top:12px;">
          <label style="display:block;font-size:12px;color:#6b7280;margin-bottom:6px;">æœå‹™é …ç›®ï¼ˆé¸æ“‡å¾ŒåŠ å…¥è³¼ç‰©è»Šï¼Œå¯é‡è¤‡åŠ å…¥ä¸åŒé¸é …ï¼‰</label>
          <select id="svcDetailVariant" style="width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);font-size:14px;"></select>
        </div>
        <div style="margin-top:16px;font-weight:800;font-size:20px;color:#0f172a;">NT$ <span id="svcDetailPrice">0</span></div>
        <div style="margin-top:12px;">
          <button id="svcDetailAddCart" class="btn primary" style="width:100%;">åŠ å…¥è³¼ç‰©è»Š</button>
        </div>
        <div class="reviews" style="margin-top:20px;">
          <div style="font-weight:800;margin-bottom:6px">é¡§å®¢è©•åƒ¹ï¼çœŸå¯¦æ•…äº‹</div>
          <div id="svcRvList"></div>
          <div style="margin-top:12px;border-top:1px solid #e5e7eb;padding-top:12px;">
            <div style="display:grid;gap:12px;margin-bottom:12px;">
              <div style="display:grid;gap:6px;">
                <label for="svcRvNick" style="font-size:12px;color:#6b7280">æ‚¨çš„åå­— (æˆ–æš±ç¨±)</label>
                <input id="svcRvNick" type="text" placeholder="ä¾‹ï¼šæ—å°å§" style="padding:10px;border:1px solid #e5e7eb;border-radius:10px;">
              </div>
              <div style="display:grid;gap:6px;">
                <label for="svcRvFile" style="font-size:12px;color:#6b7280">ä¸Šå‚³åœ–ç‰‡ (é¸å¡«)</label>
                <input id="svcRvFile" type="file" accept="image/*" style="padding:10px;border:1px solid #e5e7eb;border-radius:10px;">
              </div>
            </div>
            <textarea id="svcRvText" placeholder="åˆ†äº«æ‚¨çš„çœŸå¯¦é«”é©—ã€æ„Ÿæ‡‰æˆ–æ•…äº‹..." style="min-height:100px;"></textarea>
            <div class="cta" style="margin-top:8px;">
              <button class="btn primary" id="svcRvSubmit">é€å‡ºåˆ†äº«</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </dialog>

  <dialog id="svcCartPanel" style="border:none;border-radius:16px;padding:0;max-width:640px;width:95%;box-shadow:0 30px 60px rgba(15,23,42,.35);">
    <div style="display:flex;justify-content:space-between;align-items:center;padding:16px 18px;border-bottom:1px solid var(--line);">
      <div style="font-weight:800;font-size:18px;">æœå‹™è³¼ç‰©è»Š</div>
      <button type="button" id="svcCartPanelClose" class="xbtn">âœ•</button>
    </div>
    <div id="svcCartList" style="max-height:50vh;overflow:auto;padding:16px;display:flex;flex-direction:column;gap:10px;"></div>
    <div style="padding:0 18px 12px;">
      <div style="display:flex;justify-content:space-between;font-weight:700;">
        <span>æ‡‰ä»˜é‡‘é¡</span>
        <span id="svcCartAmount">NT$ 0</span>
      </div>
    </div>
    <div class="svc-cart-actions">
      <button class="btn" id="svcCartPanelBack">è¿”å›ä¸Šä¸€é </button>
      <button class="btn" id="svcCartClear">æ¸…ç©ºè³¼ç‰©è»Š</button>
      <button class="btn primary" id="svcCartCheckout">å¡«å¯«è¨‚å–®è³‡æ–™</button>
    </div>
  </dialog>

  <dialog id="svcCart" class="svc-dialog" data-bank-name="ä¸­åœ‹ä¿¡è¨— (822)" data-bank-account="148540417073">
    <div class="svc-stepper">
      <span data-step="1" class="active">1. ç¢ºèªæœå‹™</span>
      <span data-step="2">2. åŒ¯æ¬¾è³‡æ–™</span>
      <span data-step="3">3. å®Œæˆ</span>
    </div>
    <form id="svcCartForm" class="svc-form" enctype="multipart/form-data">
      <input type="hidden" id="svcCartServiceId">
      <div class="svc-step-content active" id="svcCartStep1" data-step="1">
        <div>
          <div class="svc-step-title">ç¢ºèªæœå‹™èˆ‡å¡«å¯«åŸºæœ¬è³‡æ–™</div>
          <p class="svc-bank-hint">è«‹å…ˆç¢ºèªæœå‹™å…§å®¹ï¼Œå†å¡«å¯«è¯çµ¡è³‡è¨Šèˆ‡ç¥ˆç¦éœ€æ±‚ï¼Œä¸‹ä¸€æ­¥å³å¯æŸ¥çœ‹åŒ¯æ¬¾å¸³æˆ¶ä¸¦ä¸Šå‚³æ†‘è­‰ã€‚</p>
        </div>
        <div class="svc-summary">
          <div>
            <div style="font-size:12px;color:#6b7280;font-weight:700;">æœå‹™å…§å®¹ç¢ºèª</div>
            <div id="svcCartServiceName" style="font-weight:700;font-size:16px;margin-top:4px;">æœå‹™åç¨±</div>
            <ul id="svcCartSummary" style="margin:6px 0 0;padding-left:18px;color:#475569;font-size:13px;line-height:1.5;"></ul>
          </div>
          <strong id="svcCartTotal">NT$ 0</strong>
        </div>
        <section class="svc-form-section">
          <label>
            è¯çµ¡äººå§“åï¼ˆå¿…å¡«ï¼‰
            <input type="text" name="name" required placeholder="è«‹è¼¸å…¥å§“å">
          </label>
          <label>
            è‹±æ–‡å§“åï¼ˆå¿…å¡«ï¼‰
            <input type="text" name="nameEn" required placeholder="è«‹è¼¸å…¥è‹±æ–‡åå­—ï¼ˆè­·ç…§/æ‹¼éŸ³ï¼‰">
          </label>
          <label>
            æ‰‹æ©Ÿè™Ÿç¢¼ï¼ˆå¿…å¡«ï¼‰
            <input type="tel" name="phone" required placeholder="ä¾‹ï¼š0969123456" inputmode="tel">
          </label>
          <label>
            Emailï¼ˆå¿…å¡«ï¼‰
            <input type="email" name="email" required placeholder="è«‹è¼¸å…¥é€šçŸ¥ç”¨ Email">
          </label>
          <label>
            ç”Ÿæ—¥ï¼ˆè¥¿å…ƒå¹´/æœˆ/æ—¥ï¼Œå¿…å¡«ï¼‰
            <input type="date" name="birth" required>
          </label>
          <label>
            æŒ‡å®šç¥ˆç¦æ—¥æœŸï¼ˆå¯ç•™ç™½ï¼‰
            <input type="date" name="requestDate">
            <span class="svc-bank-hint">å¦‚ä¸­åˆå‰å®Œæˆä¸‹å–®ï¼Œå¯é¸æ“‡ç•¶æ—¥ç¥ˆç¦ï¼›è¶…é 12:00 è«‹æ”¹é¸ç¿Œæ—¥ä»¥å¾Œã€‚</span>
          </label>
          <label>
            å‚™è¨»
            <textarea name="note" placeholder="å¯è¼¸å…¥å‚™è¨»æˆ–ç‰¹æ®Šéœ€æ±‚â€¦"></textarea>
          </label>
          <label>
            ä¸Šå‚³å€‹äººç…§ç‰‡ï¼ˆç¥ˆç¦ä½¿ç”¨ï¼Œå¿…å¡«ï¼‰
            <input type="file" id="svcContactPhoto" accept="image/*" required>
            <span class="svc-bank-hint">å»ºè­°ä¸Šå‚³æ¸…æ™°çš„æ­£é¢ç…§ç‰‡ï¼Œåƒ…ä¾›è€å¸«ç¥ˆç¦ä½¿ç”¨ã€‚</span>
            <span class="svc-bank-hint" id="svcContactPhotoName"></span>
          </label>
        </section>
        <div class="svc-step-actions">
          <button type="button" class="btn" id="svcCartBack">è¿”å›</button>
          <button type="button" class="btn primary" id="svcCartNext">å‰å¾€åŒ¯æ¬¾è³‡æ–™</button>
        </div>
      </div>

      <div class="svc-step-content" id="svcCartStep2" data-step="2">
        <div>
          <div class="svc-step-title">å¡«å¯«åŒ¯æ¬¾è³‡æ–™ä¸¦ä¸Šå‚³æ†‘è­‰</div>
          <p class="svc-bank-hint">è«‹å…ˆå®Œæˆè½‰å¸³ï¼Œå†è¼¸å…¥åŒ¯æ¬¾æœ«äº”ç¢¼ä¸¦ä¸Šå‚³åŒ¯æ¬¾æ†‘è­‰ï¼Œä»¥ä¾¿æˆ‘å€‘æ ¸å¸³ã€æˆç«‹è¨‚å–®ã€‚</p>
        </div>
        <div class="svc-bank-box">
          <div class="info">
            <span>åŒ¯æ¬¾éŠ€è¡Œ</span>
            <strong id="svcBankName">ä¸­åœ‹ä¿¡è¨— (822)</strong>
          </div>
          <div class="info">
            <span>åŒ¯æ¬¾å¸³è™Ÿ</span>
            <strong id="svcBankAccount">148540417073</strong>
          </div>
          <button type="button" class="svc-bank-copy" id="svcBankCopy">è¤‡è£½å¸³è™Ÿ</button>
        </div>
        <section class="svc-form-section">
          <label>
            åŒ¯æ¬¾é‡‘é¡ï¼ˆNT$ï¼‰
            <input type="text" id="svcBankAmount" readonly>
            <span class="svc-bank-hint">ç³»çµ±è‡ªå‹•å¸¶å…¥ï¼Œè«‹å‹¿ä¿®æ”¹ã€‚</span>
            <span class="svc-bank-hint" id="svcMemberPerkHint" style="display:none;"></span>
          </label>
          <label>
            åŒ¯æ¬¾æœ«äº”ç¢¼
            <input type="text" id="svcBankLast5" placeholder="12345" inputmode="numeric" pattern="\d{5}" required>
          </label>
          <label>
            ä¸Šå‚³åŒ¯æ¬¾æ†‘è­‰ï¼ˆç…§ç‰‡æˆ–æˆªåœ–ï¼‰
            <input type="file" id="svcBankReceipt" accept="image/*,application/pdf" required>
            <span class="svc-upload-hint">æª”æ¡ˆéœ€ 20MB ä»¥ä¸‹ï¼Œå»ºè­°ä¸Šå‚³æ¸…æ™°ç…§ç‰‡æˆ– PDFã€‚</span>
            <span class="svc-bank-hint" id="svcBankReceiptName"></span>
          </label>
          <label>
            åŒ¯æ¬¾è£œå……èªªæ˜ï¼ˆå¯ç•™ç™½ï¼‰
            <textarea id="svcBankMemo" placeholder="ä¾‹ï¼šåŒ¯æ¬¾äººå§“åèˆ‡å¸³è™Ÿã€å‚™è¨»äº‹é …"></textarea>
          </label>
        </section>
        <div class="svc-step-actions">
          <button type="button" class="btn" id="svcBankBack">ä¸Šä¸€æ­¥</button>
          <button type="submit" id="svcBankSubmit" class="btn primary">é€å‡ºåŒ¯æ¬¾è³‡æ–™</button>
        </div>
      </div>

      <div class="svc-step-content" id="svcCartStep3" data-step="3">
        <div class="svc-success-icon">âœ“</div>
        <div style="text-align:center;">
          <div class="svc-step-title">è¨‚å–®é€å‡ºæˆåŠŸ</div>
          <p class="svc-bank-hint">æˆ‘å€‘å·²æ”¶åˆ°åŒ¯æ¬¾è³‡æ–™ä¸¦å»ºç«‹ç¥ˆç¦è¨‚å–®ï¼Œè«‹ä¿ç•™ä»¥ä¸‹è³‡è¨Šæˆ–æˆªåœ–å‚™æŸ¥ã€‚</p>
        </div>
        <div class="svc-step3-card">
          <div><span style="font-size:12px;color:#6b7280;">è¨‚å–®ç·¨è™Ÿ</span><strong id="svcStep3OrderId">SVXXXXXX</strong></div>
          <div>æœå‹™å…§å®¹ï¼š<span id="svcStep3Service">â€”</span></div>
          <div>æ‡‰ä»˜é‡‘é¡ï¼š<span id="svcStep3Amount">NT$ 0</span></div>
          <div>åŒ¯æ¬¾æœ«äº”ç¢¼ï¼š<span id="svcStep3Last5">â€”</span></div>
          <div>è¯çµ¡äººï¼š<span id="svcStep3Buyer">â€”</span></div>
        </div>
        <div class="svc-bank-hint">ä¹‹å¾Œå¯é€éå·¦å´ã€Œç¥ˆç¦é€²åº¦æŸ¥è©¢ã€è¼¸å…¥æ‰‹æ©Ÿèˆ‡è¨‚å–®æœ«äº”ç¢¼ï¼ˆè‹±æ•¸ï¼‰æŸ¥è©¢æœ€æ–°é€²åº¦ã€‚</div>
        <div class="svc-step-actions">
          <button type="button" class="btn" id="svcStep3Lookup">æŸ¥è©¢é€²åº¦</button>
          <button type="button" class="btn primary" id="svcStep3Close">å®Œæˆ</button>
        </div>
      </div>
    </form>
  </dialog>

  <dialog id="svcSuccess" class="svc-dialog">
    <div class="closeBar">
      <strong>ç¥ˆç¦è¨‚å–®å·²é€å‡º</strong>
      <button id="svcSuccessClose" class="xbtn" type="button">âœ•</button>
    </div>
    <div class="svc-success-body">
      <div>
        <div style="color:#6b7280;font-size:13px;">è¨‚å–®ç·¨è™Ÿ</div>
        <div id="svcSuccessId" class="order-id">SVXXXXXX</div>
      </div>
      <div id="svcSuccessHint" style="font-size:14px;color:#374151;line-height:1.7;">
        æˆ‘å€‘æœƒåœ¨æŒ‡å®šæ™‚é–“å®Œæˆç¥ˆç¦ä¸¦é€é Email/LINE é€šçŸ¥ï¼Œäº¦å¯ä½¿ç”¨å·¦å´ã€ŒæŸ¥ç¥ˆç¦é€²åº¦ã€åŠŸèƒ½æŸ¥çœ‹æœ€æ–°ç‹€æ…‹ã€‚
      </div>
    </div>
    <footer>
      <button class="btn" id="svcSuccessLookup">æŸ¥è©¢é€²åº¦</button>
    </footer>
  </dialog>

  <script>window.LIFF_ID = '2008307812-RVDkHkD5';</script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="/js/auth.js?v=20240930"></script>
  <script src="/js/service-main.js"></script>
  <script>
    (function(){
      const badge = document.getElementById('guardianBadgeSvc');
      const fortuneDialog = document.getElementById('fortuneDialog');
      const fortuneClose = document.getElementById('fortuneClose');
      const fortuneLoading = document.getElementById('fortuneLoading');
      const fortuneError = document.getElementById('fortuneError');
      const fortuneCard = document.getElementById('fortuneCard');
      const fortuneDate = document.getElementById('fortuneDate');
      const fortuneStars = document.getElementById('fortuneStars');
      const fortuneSummary = document.getElementById('fortuneSummary');
      const fortuneAdvice = document.getElementById('fortuneAdvice');
      const fortuneRitual = document.getElementById('fortuneRitual');
      const fortuneMeta = document.getElementById('fortuneMeta');
      const fortuneRitualLabel = document.getElementById('fortuneRitualLabel');
      const fortuneShareBtn = document.getElementById('fortuneShareBtn');
      let lastFortune = null;
      let lastGuardianName = '';
      const map = {FM:'å››é¢ç¥',GA:'è±¡ç¥',CD:'å´‡è¿ªä½›',KP:'å¤å¹³',HP:'é­‚é­„å‹‡',XZ:'å¾ç¥è€äºº',WE:'äº”çœ¼å››è€³',HM:'çŒ´ç¥å“ˆé­¯æ›¼',RH:'æ‹‰èƒ¡',JL:'è¿¦æ¨“ç¾…',ZD:'æ¾¤åº¦é‡‘',ZF:'æ‹›è²¡å¥³ç¥'};
      const badgeIcon = (function(){
        if (window.GUARDIAN_BADGE_ICON) return window.GUARDIAN_BADGE_ICON;
        return '/img/guardian-emblem.png';
      })();
      function showDialog(dlg){
        if (!dlg) return;
        if (typeof dlg.showModal === 'function') dlg.showModal();
        else dlg.setAttribute('open', 'open');
      }
      function closeDialog(dlg){
        if (!dlg) return;
        if (typeof dlg.close === 'function') dlg.close();
        else dlg.removeAttribute('open');
      }
      function setFortuneLoading(){
        if (fortuneLoading) fortuneLoading.style.display = '';
        if (fortuneError) fortuneError.style.display = 'none';
        if (fortuneCard) fortuneCard.style.display = 'none';
      }
      function setFortuneError(message){
        if (fortuneError){
          fortuneError.textContent = message || 'æš«æ™‚ç„¡æ³•å–å¾—æ—¥ç±¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
          fortuneError.style.display = '';
        }
        if (fortuneLoading) fortuneLoading.style.display = 'none';
        if (fortuneCard) fortuneCard.style.display = 'none';
      }
      function renderFortune(fortune){
        if (!fortune) return;
        lastFortune = fortune;
        if (fortuneDate) fortuneDate.textContent = fortune.date || '';
        if (fortuneStars){
          const stars = fortune.stars || '';
          fortuneStars.textContent = stars;
          fortuneStars.style.display = stars ? '' : 'none';
        }
        if (fortuneSummary) fortuneSummary.textContent = fortune.summary || '';
        if (fortuneAdvice) fortuneAdvice.textContent = fortune.advice || '';
        if (fortuneRitual) fortuneRitual.textContent = fortune.ritual || '';
        if (fortuneMeta){
          const meta = fortune.meta || {};
          const tags = [];
          if (meta.userZodiac){
            const zodiacLabel = meta.userZodiacElement ? `${meta.userZodiac}ï¼ˆ${meta.userZodiacElement}è±¡ï¼‰` : meta.userZodiac;
            tags.push(`æ˜Ÿåº§ ${zodiacLabel}`);
          }
          if (meta.moonPhase) tags.push(`æœˆç›¸ ${meta.moonPhase}`);
          if (meta.iching) tags.push(`æ˜“ç¶“ ${meta.iching}`);
          if (meta.todayDow) tags.push(`ä»Šæ—¥æ˜ŸæœŸ${meta.todayDow}`);
          if (meta.thaiDayColor) tags.push(`æ³°åœ‹æ˜ŸæœŸè‰² ${meta.thaiDayColor}`);
          if (meta.buddhistYear) tags.push(`ä½›æ›† ${meta.buddhistYear}`);
          fortuneMeta.innerHTML = tags.map(t=>`<span>${t}</span>`).join('');
        }
        if (fortuneRitualLabel){
          const gName = (fortune.meta && fortune.meta.guardianName) || '';
          lastGuardianName = gName || lastGuardianName;
          fortuneRitualLabel.textContent = gName ? `å®ˆè­·ç¥ ${gName} æƒ³å°ä½ èªª` : 'å®ˆè­·ç¥æƒ³å°ä½ èªª';
        }
        if (fortuneLoading) fortuneLoading.style.display = 'none';
        if (fortuneError) fortuneError.style.display = 'none';
        if (fortuneCard) fortuneCard.style.display = '';
      }
      async function fetchFortune(){
        setFortuneLoading();
        try{
          const res = await fetch('/api/fortune', { cache:'no-store', credentials:'include' });
          const data = await res.json().catch(()=>({}));
          if (!res.ok || !data || data.ok === false){
            if (data && data.needQuiz) throw new Error('è«‹å…ˆå®Œæˆå®ˆè­·ç¥æ¸¬é©—å¾Œå†é ˜å–æ—¥ç±¤ã€‚');
            throw new Error((data && data.error) || 'å–å¾—æ—¥ç±¤å¤±æ•—');
          }
          renderFortune(data.fortune || null);
        }catch(err){
          setFortuneError(err && err.message ? err.message : 'æš«æ™‚ç„¡æ³•å–å¾—æ—¥ç±¤');
        }
      }
      async function openFortuneDialog(){
        if (!fortuneDialog) return;
        const loggedIn = window.authState && typeof window.authState.isLoggedIn==='function' ? window.authState.isLoggedIn() : false;
        if (!loggedIn){
          if (window.authState && typeof window.authState.promptLogin === 'function'){
            window.authState.promptLogin('è«‹å…ˆç™»å…¥å¾Œå†é ˜å–æ—¥ç±¤ã€‚');
          }
          return;
        }
        showDialog(fortuneDialog);
        await fetchFortune();
      }
      function drawRoundRect(ctx, x, y, w, h, r){
        const rr = Math.min(r, w / 2, h / 2);
        ctx.beginPath();
        ctx.moveTo(x + rr, y);
        ctx.arcTo(x + w, y, x + w, y + h, rr);
        ctx.arcTo(x + w, y + h, x, y + h, rr);
        ctx.arcTo(x, y + h, x, y, rr);
        ctx.arcTo(x, y, x + w, y, rr);
        ctx.closePath();
      }
      function wrapText(ctx, text, x, y, maxWidth, lineHeight){
        const words = String(text || '').split('');
        let line = '';
        for (let i = 0; i < words.length; i++) {
          const test = line + words[i];
          const metrics = ctx.measureText(test);
          if (metrics.width > maxWidth && i > 0) {
            ctx.fillText(line, x, y);
            line = words[i];
            y += lineHeight;
          } else {
            line = test;
          }
        }
        if (line) ctx.fillText(line, x, y);
        return y;
      }
      async function loadImageFromUrl(url){
        try{
          const img = new Image();
          img.crossOrigin = 'anonymous';
          return await new Promise(resolve=>{
            img.onload = ()=> resolve(img);
            img.onerror = ()=> resolve(null);
            img.src = url;
          });
        }catch(_){ return null; }
      }
      async function buildFortuneShareImage(){
        const canvas = document.createElement('canvas');
        const w = 1080;
        const h = 1920;
        canvas.width = w;
        canvas.height = h;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#0b1022';
        ctx.fillRect(0,0,w,h);
        ctx.fillStyle = 'rgba(253,224,71,0.08)';
        ctx.beginPath();
        ctx.arc(200, 160, 220, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = 'rgba(245,158,11,0.08)';
        ctx.beginPath();
        ctx.arc(900, 180, 240, 0, Math.PI * 2);
        ctx.fill();
        const pad = 80;
        ctx.fillStyle = 'rgba(15,23,42,0.9)';
        ctx.strokeStyle = 'rgba(148,163,184,0.25)';
        ctx.lineWidth = 3;
        drawRoundRect(ctx, pad, 150, w - pad * 2, h - 260, 36);
        ctx.fill();
        ctx.stroke();
        const brandImg = document.querySelector('.brand img');
        const preferredLogo = window.UNALOME_LOGO || '/logo.png';
        let logo = await loadImageFromUrl(preferredLogo);
        if (!logo && brandImg && brandImg.src){
          logo = await loadImageFromUrl(brandImg.src);
        }
        if (!logo){
          logo = await loadImageFromUrl('/img/guardian-emblem.png');
        }
        if (logo){
          ctx.drawImage(logo, pad + 40, 190, 88, 88);
        }
        ctx.fillStyle = '#e2e8f0';
        ctx.font = '600 28px system-ui, -apple-system, "Segoe UI", sans-serif';
        ctx.fillText('unalomecodes', pad + 140, 240);
        ctx.fillStyle = '#f8fafc';
        ctx.font = '800 42px system-ui, -apple-system, "Segoe UI", sans-serif';
        ctx.fillText('ä»Šæ—¥å°ˆå±¬æ—¥ç±¤', pad + 40, 320);
        ctx.fillStyle = '#94a3b8';
        ctx.font = '500 24px system-ui, -apple-system, "Segoe UI", sans-serif';
        ctx.fillText(lastFortune.date || '', pad + 40, 360);
        let summaryStart = lastGuardianName ? 460 : 440;
        if (lastGuardianName){
          ctx.fillStyle = '#cbd5f5';
          ctx.font = '600 24px system-ui, -apple-system, "Segoe UI", sans-serif';
          ctx.fillText(`å®ˆè­·ç¥ï¼š${lastGuardianName}`, pad + 40, 398);
        }
        const starLine = lastFortune.stars || '';
        if (starLine){
          ctx.fillStyle = '#fbbf24';
          ctx.font = '600 28px system-ui, -apple-system, "Segoe UI", sans-serif';
          ctx.fillText(starLine, pad + 40, summaryStart);
          summaryStart += 52;
        }
        ctx.fillStyle = '#f8fafc';
        ctx.font = '700 32px system-ui, -apple-system, "Segoe UI", sans-serif';
        const summaryEnd = wrapText(ctx, lastFortune.summary || '', pad + 40, summaryStart, w - pad * 2 - 80, 44);
        let y = summaryEnd + 70;
        ctx.fillStyle = '#94a3b8';
        ctx.font = '600 22px system-ui, -apple-system, "Segoe UI", sans-serif';
        ctx.fillText('ç”Ÿæ´»å°å»ºè­°', pad + 40, y);
        y += 50;
        ctx.fillStyle = '#e2e8f0';
        ctx.font = '500 28px system-ui, -apple-system, "Segoe UI", sans-serif';
        const adviceEnd = wrapText(ctx, lastFortune.advice || '', pad + 40, y, w - pad * 2 - 80, 40);
        y = adviceEnd + 70;
        const label = lastGuardianName ? `å®ˆè­·ç¥ ${lastGuardianName} æƒ³å°ä½ èªª` : 'å®ˆè­·ç¥æƒ³å°ä½ èªª';
        ctx.fillStyle = '#94a3b8';
        ctx.font = '600 22px system-ui, -apple-system, "Segoe UI", sans-serif';
        ctx.fillText(label, pad + 40, y);
        y += 50;
        ctx.fillStyle = '#e2e8f0';
        ctx.font = '500 28px system-ui, -apple-system, "Segoe UI", sans-serif';
        wrapText(ctx, lastFortune.ritual || '', pad + 40, y, w - pad * 2 - 80, 40);
        return new Promise(resolve=>{
          canvas.toBlob(b=> resolve(b), 'image/png');
        });
      }
      async function shareFortuneImage(){
        if (!lastFortune) return;
        if (fortuneShareBtn) {
          fortuneShareBtn.disabled = true;
          fortuneShareBtn.textContent = 'ç”¢ç”Ÿä¸­â€¦';
        }
        try{
          const blob = await buildFortuneShareImage();
          if (!blob) throw new Error('åœ–ç‰‡ç”¢ç”Ÿå¤±æ•—');
          const fileName = `fortune-${(lastFortune.date || '').replace(/\//g,'-') || 'today'}.png`;
          const file = new File([blob], fileName, { type:'image/png' });
          if (navigator.share && navigator.canShare && navigator.canShare({ files:[file] })){
            await navigator.share({ title:'æˆ‘çš„ä»Šæ—¥æ—¥ç±¤', files:[file] });
          }else{
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            a.remove();
            setTimeout(()=> URL.revokeObjectURL(url), 500);
          }
        }catch(err){
          if (fortuneError){
            fortuneError.textContent = err && err.message ? err.message : 'åˆ†äº«å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
            fortuneError.style.display = '';
          }
        }finally{
          if (fortuneShareBtn) {
            fortuneShareBtn.disabled = false;
            fortuneShareBtn.textContent = 'è‡ªå‹•æˆªåœ–åˆ†äº«';
          }
        }
      }
      function readGuardian(){
        try{
          const loggedIn = window.authState && typeof window.authState.isLoggedIn === 'function'
            ? window.authState.isLoggedIn()
            : false;
          if (loggedIn && window.authState && typeof window.authState.getProfile === 'function'){
            const p = window.authState.getProfile();
            if (p && p.guardian) return p.guardian;
            return null;
          }
          const raw = localStorage.getItem('__lastQuizGuardian__');
          if (raw){
            const obj = JSON.parse(raw);
            if (obj && obj.code) return obj;
          }
          return null;
        }catch(_){ return null; }
      }
      function render(){
        if (!badge) return;
        const loggedIn = window.authState && typeof window.authState.isLoggedIn==='function' ? window.authState.isLoggedIn() : false;
        if (!loggedIn){
          badge.style.display = 'none';
          return;
        }
        const g = readGuardian();
        if (!g){
          badge.style.display = 'none';
          return;
        }
        const code = String(g.code||'').toUpperCase();
        const name = map[code] || 'å®ˆè­·ç¥';
        badge.innerHTML = `<img src="${badgeIcon}" alt="å®ˆè­·ç¥"><div class="guardian-meta"><strong>å®ˆè­·ç¥ï¼š${name}</strong><button type="button" class="fortune-btn" data-fortune-btn>é ˜å–æ—¥ç±¤</button></div>`;
        badge.style.display = 'flex';
        const btn = badge.querySelector('[data-fortune-btn]');
        if (btn){
          btn.addEventListener('click', openFortuneDialog);
        }
      }
      if (window.authState && typeof window.authState.onProfile === 'function'){
        window.authState.onProfile(()=>render());
      }
      setTimeout(render, 800);
      render();
      if (fortuneClose){
        fortuneClose.addEventListener('click', ()=> closeDialog(fortuneDialog));
      }
      if (fortuneShareBtn){
        fortuneShareBtn.addEventListener('click', shareFortuneImage);
      }
    })();
  </script>
</body>
</html>
