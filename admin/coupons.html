<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>å„ªæƒ åˆ¸å·¥å…·ï½œunalomecodes</title>
<style>
  :root{
    --bg:#f7f8fb;--fg:#0f172a;--muted:#6b7280;--panel:#ffffff;--line:#e5e7eb;--accent:#2563eb;--accent2:#10b981;
    --shadow:0 18px 40px rgba(15,23,42,.12);
  }
  *{box-sizing:border-box;}body{margin:0;font-family:"Space Grotesk","Segoe UI",system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--fg);}
  .wrap{max-width:960px;margin:0 auto;padding:20px 16px 36px;}
  .top{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:16px;}
  .top h1{margin:0;font-size:22px;font-weight:800;}
  .top .muted{margin:0;font-size:13px;color:var(--muted);}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);padding:16px;margin-bottom:14px;}
  label{display:block;font-weight:700;font-size:13px;margin-bottom:6px;color:#0f172a;}
  input,select{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;font-size:15px;background:#fff;}
  .grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));}
  button{appearance:none;border:none;border-radius:12px;padding:12px 14px;font-weight:800;font-size:15px;cursor:pointer;}
  .btn-primary{background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;box-shadow:0 10px 24px rgba(37,99,235,.25);}
  .btn-ghost{background:#fff;border:1px solid var(--line);color:var(--fg);}
  .result{margin-top:12px;padding:12px;border-radius:12px;border:1px solid #bbf7d0;background:#f0fdf4;color:#166534;font-weight:700;word-break:break-all;}
  .error{margin-top:12px;padding:12px;border-radius:12px;border:1px solid #fecdd3;background:#fff1f2;color:#b91c1c;font-weight:700;}
  .actions{display:flex;gap:10px;flex-wrap:wrap;}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>å„ªæƒ åˆ¸å·¥å…·</h1>
      <p class="muted">ç”¢ç”Ÿå–®ä¸€ç¥ç¥‡å›ºå®šé‡‘é¡å„ªæƒ ç¢¼ï¼ˆé è¨­ NT$200ï¼‰ã€‚</p>
    </div>
    <div class="actions">
      <a class="btn-ghost" href="./index.html" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;">â† è¿”å›å¾Œå°é¦–é </a>
      <a class="btn-ghost" href="/shop.html" style="text-decoration:none;display:inline-flex;align-items:center;gap:6px;">ğŸ  å•†å“é¦–é </a>
    </div>
  </div>

  <div class="card">
    <div class="grid">
      <div>
        <label for="cpnDeity">å®ˆè­·ç¥ä»£ç¢¼ï¼ˆä¾‹ï¼šFMã€GAã€XZï¼‰</label>
        <input id="cpnDeity" placeholder="å¿…å¡«ï¼Œå¦‚ï¼šFM">
      </div>
      <div>
        <label for="cpnAmount">æŠ˜æŠµé‡‘é¡ï¼ˆNT$ï¼‰</label>
        <input id="cpnAmount" type="number" min="1" value="200">
      </div>
    </div>
    <div class="actions" style="margin-top:14px;">
      <button class="btn-primary" id="btnIssue">ç”¢ç”Ÿå„ªæƒ åˆ¸</button>
      <button class="btn-ghost" id="btnClear">æ¸…ç©ºçµæœ</button>
    </div>
    <div id="cpnResult" class="result" style="display:none;"></div>
    <div id="cpnError" class="error" style="display:none;"></div>
  </div>
</div>
<script>
  async function issue(){
    const deity = (document.getElementById('cpnDeity').value||'').trim().toUpperCase();
    const amount = Number(document.getElementById('cpnAmount').value||200)||200;
    const resBox = document.getElementById('cpnResult');
    const errBox = document.getElementById('cpnError');
    resBox.style.display='none'; errBox.style.display='none';
    if (!deity){
      errBox.textContent = 'è«‹è¼¸å…¥å®ˆè­·ç¥ä»£ç¢¼ï¼ˆå¦‚ FM / GA / XZï¼‰';
      errBox.style.display='block';
      return;
    }
    try{
      const resp = await fetch('/api/coupons/issue', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ deity, amount })
      });
      const data = await resp.json().catch(()=>({}));
      if (!resp.ok || !data || !data.code){
        throw new Error(data && data.error ? data.error : 'ç™¼åˆ¸å¤±æ•—');
      }
      resBox.innerHTML = `å„ªæƒ ç¢¼ï¼š${data.code} <br>å®ˆè­·ç¥ï¼š${data.deity || deity}ï½œæŠ˜æŠµï¼šNT$ ${Number(data.amount||amount)}`;
      resBox.style.display='block';
      try{ navigator.clipboard.writeText(data.code); }catch(_){}
    }catch(err){
      errBox.textContent = err.message || 'ç™¼åˆ¸å¤±æ•—';
      errBox.style.display='block';
    }
  }
  document.getElementById('btnIssue').addEventListener('click', issue);
  document.getElementById('btnClear').addEventListener('click', ()=>{
    document.getElementById('cpnResult').style.display='none';
    document.getElementById('cpnError').style.display='none';
  });
</script>
</body>
</html>
