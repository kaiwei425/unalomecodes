<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="description" content="後台優惠券管理工具（僅限管理員）。">
<meta name="robots" content="noindex,nofollow">
<link rel="canonical" href="https://shop.unalomecodes.com/admin/coupons">
<title>unalomecodes | 懂玩泰國 - 後台 coupons</title>
<link rel="stylesheet" href="/css/admin-coupons.inline-1.css">
<script src="/js/admin-coupons.inline-1.js"></script>
<script src="/js/admin-guard.js" defer></script>
<link rel="stylesheet" href="/admin/admin-ui.css">
<script src="/js/admin-shell.js" defer></script>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>優惠券工具</h1>
      <p class="muted">支援神祇券、全館券、免運券與批次發放。</p>
    </div>
    <div class="top-actions">
      <a class="pill-link" href="/admin">← 返回後台首頁</a>
      <a class="pill-link" href="/">🏠 入口首頁</a>
    </div>
  </div>

  <div class="card">
    <div class="grid">
      <div>
        <label for="cpnType">券種</label>
        <select id="cpnType">
          <option value="DEITY">單一神祇券</option>
          <option value="ALL">全館折扣券</option>
          <option value="SHIP">免運券</option>
        </select>
      </div>
      <div>
        <label for="cpnDeity">守護神代碼</label>
        <select id="cpnDeity">
          <option value="">載入守護神清單中...</option>
        </select>
      </div>
      <div>
        <label for="cpnAmount">折抵金額（NT$）</label>
        <input id="cpnAmount" type="number" min="1" value="200">
      </div>
      <div>
        <label for="cpnStart">生效時間（選填）</label>
        <input id="cpnStart" type="datetime-local">
      </div>
      <div>
        <label for="cpnExpire">到期時間（選填）</label>
        <input id="cpnExpire" type="datetime-local">
      </div>
    </div>
    <div class="actions" style="margin-top:14px;">
      <button class="btn-primary" id="btnIssue">產生優惠券</button>
      <button class="btn-ghost" id="btnClear">清空結果</button>
    </div>
    <div id="cpnResult" class="result" style="display:none;"></div>
    <div id="cpnError" class="error" style="display:none;"></div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 10px;font-size:16px;font-weight:800;">批次發放（全館 / 免運券）</h3>
    <div class="grid">
      <div>
        <label for="batchType">券種</label>
        <select id="batchType">
          <option value="ALL">全館折扣券（ALL）</option>
          <option value="SHIP">免運券（SHIP）</option>
        </select>
      </div>
      <div>
        <label for="batchAmount">折抵金額（NT$）</label>
        <input id="batchAmount" type="number" min="1" value="200">
      </div>
      <div>
        <label for="batchStart">生效時間（選填）</label>
        <input id="batchStart" type="datetime-local">
      </div>
      <div>
        <label for="batchExpire">到期時間（選填）</label>
        <input id="batchExpire" type="datetime-local">
      </div>
      <div>
        <label for="batchTarget">發放對象</label>
        <select id="batchTarget">
          <option value="all">全部會員</option>
          <option value="buyers">曾下單會員</option>
        </select>
      </div>
    </div>
    <div class="actions" style="margin-top:14px;">
      <button class="btn-primary" id="btnBatch">批次發放</button>
      <div id="batchMsg" class="result" style="display:none;"></div>
    </div>
  </div>

  <div class="card">
    <div class="toolbar">
      <input id="q" placeholder="搜尋券碼 / 守護神" style="padding:10px 12px;border-radius:12px;border:1px solid var(--line);min-width:200px;">
      <select id="filterUsed" style="padding:10px 12px;border-radius:12px;border:1px solid var(--line);">
        <option value="">全部</option>
        <option value="false">未使用</option>
        <option value="true">已使用</option>
      </select>
      <button class="btn-ghost" id="btnReload" type="button">重新整理</button>
      <button class="btn-primary" id="btnShowGlobal" type="button" style="background:#111827;">全館/免運清單</button>
    </div>
    <table>
      <thead>
        <tr>
          <th style="width:180px">券碼</th>
          <th style="width:90px">類型</th>
          <th style="width:120px">守護神</th>
          <th style="width:90px">金額</th>
          <th style="width:120px">生效</th>
          <th style="width:120px">到期</th>
          <th>發放時間</th>
          <th style="width:120px">狀態</th>
          <th style="width:180px">使用於訂單</th>
          <th style="width:150px">使用時間</th>
        </tr>
      </thead>
      <tbody id="cpnList"><tr><td colspan="10" class="muted">尚未載入</td></tr></tbody>
    </table>
  </div>

  <div id="globalPanel" class="card" style="display:none;">
    <div style="display:flex;align-items:center;gap:10px;justify-content:space-between;">
      <div>
        <h3 style="margin:0;font-size:16px;font-weight:800;">全館/免運券發放列表</h3>
        <p class="muted" style="margin:4px 0 0;">僅顯示類型為 ALL / SHIP 的券，方便查看發放與使用情形。</p>
      </div>
      <button id="btnCloseGlobal" class="btn-ghost" type="button">關閉</button>
    </div>
    <table style="margin-top:10px;">
      <thead>
        <tr>
          <th style="width:200px">券碼</th>
          <th style="width:80px">類型</th>
          <th style="width:80px">金額</th>
          <th style="width:140px">發放</th>
          <th style="width:140px">生效</th>
          <th style="width:140px">到期</th>
          <th style="width:120px">狀態</th>
          <th style="width:180px">使用訂單</th>
          <th style="width:160px">使用時間</th>
        </tr>
      </thead>
      <tbody id="globalList"><tr><td colspan="9" class="muted">載入中…</td></tr></tbody>
    </table>
  </div>
</div>
<script src="/js/admin-coupons.inline-2.js"></script>
</body>
</html>
