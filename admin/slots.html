<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="後台時段管理頁（僅限 owner / booking）。">
<meta name="robots" content="noindex,nofollow">
<link rel="canonical" href="https://unalomecodes.com/admin/slots">
<title>unalomecodes | 懂玩泰國 - 後台 slots</title>
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
<link rel="stylesheet" href="/admin/admin-ui.css">
<link rel="stylesheet" href="/css/admin-slots.inline-1.css">
<script src="/js/admin-guard.js" defer></script>
<script src="/js/admin-shell.js" defer></script>
</head>
<body class="admin-view admin-slots-view">
  <div class="wrap" data-admin-page="slots">
    <div class="backLink"><a class="backBtn" href="/admin">← 返回主選單</a></div>
    <div class="page">
      <div class="page-head">
        <div class="page-title">
          <h1 data-i18n="slots_title">時段管理</h1>
          <div class="page-sub" data-i18n="slots_sub">Manage published slots for booking</div>
        </div>
        <div class="page-actions">
          <div class="langToggle">
            <button type="button" id="langZh" data-i18n="lang_zh">中文</button>
            <button type="button" id="langEn" data-i18n="lang_en">EN</button>
          </div>
        </div>
      </div>
        <div id="slotsGuard" class="card muted" style="display:none;"></div>
        <div class="page-body">
          <div class="panel panel-controls">
            <div id="adminSlotsWarning" class="muted" style="display:none;padding:10px 12px;border:1px solid rgba(15,23,42,.12);border-radius:12px;background:#fff7ed;color:#7c2d12;margin-bottom:10px;">
              ⚠️ Slot changes affect customer bookings and notifications.
            </div>
          <div class="slot-controls">
            <div class="slot-field">
              <div id="serviceIdDisplay" class="muted" style="font-weight:700;">Service ID: —</div>
              <input type="text" id="serviceIdInput" placeholder="輸入 serviceId" style="display:none;">
            </div>
            <div class="slot-field slot-date-nav">
              <button type="button" class="btn" id="slotPrevDay" aria-label="前一天">←</button>
              <div id="slotDateLabel" class="date-label"></div>
              <button type="button" class="btn" id="slotNextDay" aria-label="後一天">→</button>
            </div>
            <button class="btn" id="btnLoad" data-i18n="btn_load">載入時段</button>
          </div>
          <div class="slot-controls slot-booking-controls">
            <div class="slot-field">
              <div class="slot-label" data-i18n="booking_mode_label">預約模式</div>
              <div id="bookingModeToggle" class="booking-mode-toggle">
                <button type="button" class="btn mode-btn" data-mode="legacy" data-i18n="booking_mode_legacy">原本模式（一直可預約）</button>
                <button type="button" class="btn mode-btn" data-mode="windowed" data-i18n="booking_mode_windowed">限時模式（手動開放）</button>
              </div>
            </div>
            <div class="slot-field slot-field-compact">
              <label for="bookingWindowMinutes" data-i18n="booking_window_minutes">開放時長（分鐘）</label>
              <input id="bookingWindowMinutes" type="number" min="15" step="5" value="60">
            </div>
            <div class="slot-booking-actions">
              <button class="btn primary" id="btnPublishWindow" type="button" data-i18n="booking_publish_window">一鍵上架 + 開放</button>
              <button class="btn" id="btnCloseWindow" type="button" data-i18n="booking_close_window">立即關閉預約</button>
            </div>
          </div>
          <div id="bookingWindowStatus" class="muted" data-i18n="booking_status_loading" style="margin-top:6px;"></div>
          <div id="slotTzHint" class="slot-tz-hint muted"></div>
          <div class="slot-actions">
            <button class="btn primary" id="btnPublish" data-i18n="btn_publish">開放選取時段</button>
            <button class="btn" id="btnUnpublish" data-i18n="btn_unpublish">取消選取時段</button>
            <button class="btn danger" id="btnReleaseBooked" data-i18n="btn_release_booked">解除已預約時段</button>
          </div>
          <div class="slot-legend">
            <span>🟢 <span data-i18n="status_free">可預約</span></span>
            <span>🟡 <span data-i18n="status_held">保留中</span></span>
            <span>🔴 <span data-i18n="status_booked">已預約</span></span>
            <span>⚪ <span data-i18n="status_not_published">未開放</span></span>
          </div>
        </div>
        <div class="panel panel-slots">
          <div id="slotGrid" class="slot-grid"></div>
        </div>
        <div class="panel panel-published">
          <div class="panel-head">
            <div class="panel-title" data-i18n="published_title">已開放時段（含日期）</div>
            <button class="btn" id="btnPublishedRefresh" type="button" data-i18n="btn_published_refresh">重新整理已開放時段</button>
          </div>
          <div id="publishedSlots" class="published-list muted"></div>
        </div>
        <div class="panel panel-consult">
          <div class="slot-actions" style="justify-content:space-between;align-items:center;">
            <div class="muted" data-i18n="consult_title">電話算命預約 / Consult Queue</div>
            <button class="btn" id="btnConsultReload" type="button" data-i18n="btn_consult_reload">重新整理</button>
          </div>
          <div id="consultList" class="muted"></div>
        </div>
        <div class="panel panel-status">
          <div id="slotStatus" class="muted"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="/js/admin-slots.inline-2.js"></script>
</body>
</html>
