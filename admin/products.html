<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover" />
<meta name="description" content="後台商品管理頁（僅限管理員）。" />
<meta name="robots" content="noindex,nofollow" />
<link rel="canonical" href="https://unalomecodes.com/admin/products" />
<title>unalomecodes | 懂玩泰國 - 後台 products</title>
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16.png">
<meta name="theme-color" content="#f8fafc" />
<link rel="stylesheet" href="/css/admin-products.inline-1.css">
<script src="/js/admin-products.inline-1.js"></script>
<script src="/js/admin-guard.js" defer></script>
<link rel="stylesheet" href="/admin/admin-ui.css">
<script src="/js/admin-shell.js" defer></script>
</head>
<body>
<div class="wrap">
  <div class="backLink"><a class="backBtn" href="/admin">← 返回主選單</a></div>
  <h1>商品管理後台</h1>
  <div class="grid">
    <!-- 左：新增商品 -->
    <div class="card">
      <h3 style="margin:0 0 6px">新增商品</h3>
      <div class="muted">上傳多張圖片 → 設定基本資料與規格 → 建立</div>
      <label>商品名稱</label>
      <input id="new_name" placeholder="例：四面神 · 開運加持牌" />

      <label>神祇（方便前台篩選，可留空）</label>
      <input id="new_deity" placeholder="例：四面神 / 象神 / 招財女神…" />
      <label>神祇代碼（用於優惠券比對，兩碼大寫）</label>
      <select id="new_deityCode">
        <option value="">（不設定）</option>
        <option value="WE">WE｜五眼四耳</option>
        <option value="XZ">XZ｜徐祝老人</option>
        <option value="KP">KP｜坤平</option>
        <option value="CD">CD｜崇迪</option>
        <option value="RH">RH｜拉胡</option>
        <option value="HM">HM｜哈魯曼</option>
        <option value="FM">FM｜四面神</option>
        <option value="GA">GA｜象神</option>
        <option value="JL">JL｜迦樓羅</option>
        <option value="ZD">ZD｜澤度金</option>
        <option value="ZF">ZF｜招財女神</option>
        <option value="HP">HP｜魂魄勇</option>
      </select>
      <div class="hint">建議同時填「神祇名稱」與「神祇代碼」。前台折扣比對會以代碼為準。</div>

      <label>分類（決定前台流程）</label>
      <select id="new_category">
        <option value="佛牌/聖物">佛牌/聖物</option>
        <option value="蠟燭加持祈福">連線算命 / 捐棺行善</option>
        <option value="跑廟行程">跑廟行程</option>
        <option value="其他">其他</option>
      </select>

      <div class="row">
        <div style="flex:1">
          <label>基礎價格（NT$）</label>
          <input id="new_price" type="number" min="0" step="1" value="0" />
        </div>
        <div style="flex:1">
          <label>已售出（顯示用，會隨訂單自動累加）</label>
          <input id="new_sold" type="number" min="0" step="1" value="0" />
        </div>
      </div>
      <label>限時上架至（選填）</label>
      <input id="new_limited_until" type="datetime-local" />
      <div class="hint">留空代表不限時，到期會自動隱藏。</div>

      <label>商品描述</label>
      <textarea id="new_desc" placeholder="材質、尺寸、加持資訊、注意事項…"></textarea>
      <label>Instagram 影片連結（選填）</label>
      <input id="new_instagram" placeholder="https://www.instagram.com/p/XXXX/">
      <div class="hint">貼上 IG 貼文或 Reels 的網址，前台商品頁會自動嵌入影片。</div>

      <div class="hr"></div>

      <div class="row" style="align-items:center;justify-content:space-between">
        <label style="margin:0">圖片上傳（可多選）</label>
        <button class="btn ghost" id="btnUpload">選擇圖片</button>
        <input id="filePicker" type="file" accept="image/*" multiple style="display:none" />
      </div>
      <div class="thumbs" id="new_imgs"></div>
      <div class="hint">上傳成功後會出現縮圖；點右上角 × 可刪除並移除檔案（會刪 R2）。</div>

      <div class="hr"></div>

      <label>規格（外殼）</label>
      <div class="varHead"><div>名稱</div><div>加價（NT$）</div><div>庫存</div><div></div></div>
      <div class="variants" id="new_vars"></div>
      <button class="btn" id="btnAddVar" style="margin-top:8px">＋新增規格</button>

      <div class="hr"></div>
      <div class="row" style="gap:8px">
        <button class="btn primary" id="btnCreate">建立商品</button>
        <div class="muted" id="createMsg"></div>
      </div>
    </div>

    <!-- 右：商品列表 -->
    <div class="card">
      <div class="toolbar">
        <div class="row" style="gap:8px;align-items:center">
          <input id="q" placeholder="搜尋名稱/神祇關鍵字…" style="width:260px" />
          <span class="pill">
            <label style="margin:0;display:flex;gap:6px;align-items:center">
              <input id="onlyActive" type="checkbox" />
              只看上架
            </label>
          </span>
        </div>
        <button class="btn" id="btnReload">重新整理</button>
      </div>
      <table>
        <thead>
          <tr>
            <th style="width:60px">圖</th>
            <th>商品</th>
            <th style="width:120px">分類</th>
            <th style="width:110px">價格</th>
            <th style="width:100px">已售出</th>
            <th style="width:210px">操作</th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
    </div>
  </div>

  <div class="footer">© 2025-2026 unalomecodes</div>
</div>

<!-- 編輯 Modal -->
<div class="modal" id="editModal">
  <div class="box">
    <div class="head">
      <h3 style="margin:0">編輯商品</h3>
      <button class="close" id="closeEdit">關閉</button>
    </div>
    <div id="editBody"></div>
  </div>
</div>

<script src="/js/admin-products.inline-2.js"></script>
</body>
</html>
